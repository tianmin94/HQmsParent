<#include "../include/header.html">
<script src="${base.contextPath}/common/code?yesNo=SYS.YES_NO"></script><!-- 是否 -->
<script src="${base.contextPath}/common/code?hqmNonconformingSource=HQM_NONCONFORMING_SOURCE"></script><!-- 来源类型 -->
<script src="${base.contextPath}/common/code?hqmNoDealMethod=HQM_SAMPLE_DISPOSAL_METHOD"></script><!-- 处理方法 -->
<script src="${base.contextPath}/common/code?hqmNoStatus=HQM_NO_STATUS"></script><!-- 状态 -->
<script src="${base.contextPath}/common/code?hqmFillInType=HQM_FILL_IN_TYPE"></script>
<script src="${base.contextPath}/common/code?hqmIqcInspectionType=HQM_INSPECTION_TYPE"></script><!-- 检验类型 -->
<script src="${base.contextPath}/common/code?hqmIqcSamplePlanType=HQM_IQC_SAMPLE_PLAN_TYPE"></script><!-- 抽样方案(抽样计划类型) -->
<script src="${base.contextPath}/common/code?hqmIqcSampleStandardType=HQM_IQC_SAMPLE_STANDARD_TYPE"></script><!-- 抽样标准类型 -->
<script src="${base.contextPath}/common/code?hqmIqcSolveStatus=HQM_INSPECTION_TASK_STATUS"></script>
<script src="${base.contextPath}/common/code?hqmInspectionResult=HQM_INSPECTION_RESULT"></script>
<script src="${base.contextPath}/common/code?hqmIqcSourceType=HQM_IQC_SOURCE_TYPE"></script>
<script src="${base.contextPath}/common/code?hqmIqcAttributeCategory=HQM_IQC_ATTRIBUTE_CATEGORY"></script><!-- 检验项类别 -->
<script src="${base.contextPath}/common/code?hqmIqcInspectionLevels=HQM_IQC_INSPECTION_LEVELS"></script><!-- 检验水平 -->
<script src="${base.contextPath}/common/code?hqmIqcQualityGrade=HQM_IQC_QUALITY_GRADE"></script><!-- 质量特性等级 -->
<script src="${base.contextPath}/common/code?hqmIqcAql=HQM_IQC_AQL"></script><!-- AQL(质量接收限制) -->
<script src="${base.contextPath}/common/code?hqmIqcStandardType=HQM_IQC_STANDARD_TYPE"></script>
<script src="${base.contextPath}/common/code?hqmPqcInspectionStatus=HQM_PQC_INSPECTION_STATUS"></script>
<script src="${base.contextPath}/common/code?hqmPqcSourceType=HQM_PQC_SOURCE_TYPE"></script>
<script src="${base.contextPath}/common/code?hqmFqcInspectionFrom=HQM_FQC_INSPECTION_FROM"></script>
<script src="${base.contextPath}/common/code?HQM_INSPECTION_SOLVE_WAY=HQM_PQC_SOLVE_WAY"></script>
<script src="${base.contextPath}/common/code?HQM_INSPECTION_METHOD=HQM_INSPECTION_METHOD"></script>
<script src="${base.contextPath}/common/code?HQM_SAMPLE_TYPE=HQM_SAMPLE_TYPE"></script>

<script src="${base.contextPath}/common/code?hqmIqcAttributeCategory=HQM_IQC_ATTRIBUTE_CATEGORY"></script>
<script src="${base.contextPath}/common/code?hqmIqcStandardType=HQM_IQC_STANDARD_TYPE"></script>
<script src="${base.contextPath}/common/code?hqmStandradUom=HQM_STANDARD_UOM"></script>

<script type="text/javascript">
var viewModel = Hap.createGridViewModel("#grid");
var viewModelLine = Hap.createGridViewModel("#gridLine");
var inspectionNum = "${RequestParameters.inspectionNum}";
var data;
</script>
<body>
<script>
        viewModel.confirm= function(){
		var dialog = $("#childWindow").kendoWindow({
            width: window.innerWidth * 0.95,
            height: window.innerHeight * 0.9,
            title: '选择检验单',
            visible: false,
            iframe: true,
            modal: true,
            content: '../hqm_iqc_inspection_h/iqc_inspection_h.html'
        }).data("kendoWindow");  
	    dialog.center().open(); 
	}     
	
       function  loadData(){
    		document.getElementById("inspectionId").value = data.inspectionNum
    		//工厂
    		viewModel.model.set('plantCode',data.plantCode)    		
    		//检验类型   		
    		viewModel.model.set('inspectionType',data.inspectionType)
            //来源类型 
            viewModel.model.set('noSourceType','1')
    		//处理单状态   		
    		viewModel.model.set('noStatus',data.inspectionStatus)
    		//检验员
    		viewModel.model.set('approvalId',data.inspectorUserName)
    		//检验时间 
    		viewModel.model.set('inspectionDate',data.inspectionDate)
    	}
   	viewModel.save=function(e){
   		 	var data2= viewModel.model.toJSON();   		
   			{
   				$.ajax({
   			        url: '${base.contextPath}/hqm/nonconforming/order/addnew',
   			        type: 'POST',
   			        data: data2,
   			        async: false,
//   			         contentType: "application/json",
   			        dataType: "json",
   			        success: function (response) {
   			            if (response.success) {
   			            	kendo.ui.showInfoDialog({
   			                      message: "成功"
   			               });  			            	
   			            } else {
   			            	kendo.ui.showWarningDialog({
   			                    message: response.message
   			                });
   			            }
   			        }
   			    });
   			}
   		}
   		viewModel.closeWin=function(e){
           	window.parent.$("#createInspectionWindow").data("kendoWindow").close();
           }
</script>   

<script>
$(function(){
		//获取检验单号对应的检验单信息	
		var data1 = {"inspectionNum":inspectionNum};
		$.ajax({
	        url: '${base.contextPath}/hqm/pqc/inspection/h/select',
	        type: 'POST',
	        data: data1,
	        async: false,
	        dataType: "json",
	        success: function (response) {
	            if (response.success) {
	            	if(response.rows!=undefined&&response.rows.length!=0){
	            		//response.rows[0];
	            		//赋值 
	            		//工厂
    		    viewModel.model.set('plantCode',response.rows[0].plantCode) ;
    		    viewModel.model.set('plantId',response.rows[0].plantId)  ;
    		      //检验类型   		
    		    viewModel.model.set('inspectionType',response.rows[0].inspectionType);
    		    //来源类型 
                 viewModel.model.set('noSourceType','1');
                //物料 
                // viewModel.model.set('itemCode',response.rows[0].itemCode);		
                // viewModel.model.set('itemId',response.rows[0].itemId);		
                // viewModel.model.set('itemDescriptions',response.rows[0].itemDescriptions);
	            //供应商                 
                // viewModel.model.set('supplierId',response.rows[0].supplierId);		
                // viewModel.model.set('supplierCode',response.rows[0].supplierCode);	
               //  viewModel.model.set('SupplierName',response.rows[0].supplierName);
                 //批次
               //  viewModel.model.set('productionBatch',response.rows[0].productionBatch);
                 //接受时间 
                // viewModel.model.set('receiveDate',response.rows[0].receiveDate);
                 //样本数量 
               //  viewModel.model.set('sampleSize',response.rows[0].sampleSize);
                 //接受数
               //  viewModel.model.set('totalityQty',response.rows[0].receiveQty);
                 //不合格数
               //  if(response.rows[0].ngQty=null){viewModel.model.set('nonconformingQty','0');}else {viewModel.model.set('nonconformingQty',response.rows[0].ngQty);}
                 //来源检验单       
              //   viewModel.model.set('inspectionCode',response.rows[0].inspectionNum);
              //   viewModel.model.set('inspectionId',response.rows[0].headerId);
                 //检验日期
              //   viewModel.model.set('inspectionDate',response.rows[0].inspectionDate);
                 //检验人
              //   viewModel.model.set('approvalName',response.rows[0].inspectorId);
               //  viewModel.model.set('approvalId',response.rows[0].inspectorUserName);
               
                 viewModel.model.set('userName',response.rows[0].inspectorUserName);
                 viewModel.model.set('approvalId',response.rows[0].inspectorId);
                 
                 viewModel.model.set('inspectionCode',response.rows[0].inspectionNum);
                 viewModel.model.set('inspectionId',response.rows[0].headerId);
                 
                 viewModel.model.set('inspectionDate',response.rows[0].inspectionDate);
                 viewModel.model.set('dealMethod',response.rows[0].solveWay);
                 viewModel.model.set('headerId',response.rows[0].headerId);
                 
                 gridLine.dataSource.fetch();
            	}else{
	            		kendo.ui.showWarningDialog({
	                        message: "无对应检验单信息"
	                    });
	            	}
	            } else {
	            	kendo.ui.showWarningDialog({
	                    message: "检验单信息获取失败"
	                });
	            }
	        }
	    });
	})
</script>     
<div id="childWindow"></div>
<div id="page-content">

   <div class="row">
    <div class="pull-left" id="toolbar-btn" style="padding-bottom:10px;">
         <span class="btn btn-success k-grid-save-changes" style="float:left;margin-left:30px;"  data-bind="click:save"><i class="fa fa-save" style="margin-right:3px;"></i><@spring.message "hap.save"/></span>      
      <!-- <span class="btn btn-success k-grid-save-changes" data-bind="click:confirm" style="float:left;margin-right:8px;"><@spring.message "关联检验单 "/></span>-->
    </div>
    <script>kendo.bind($('#toolbar-btn'), viewModel);</script>
    </div>
    
    <div class="row" style="margin-top: 30px;margin-right:6%;font-size:14px">
		    <div class="col-sm-3">
		    	    <lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">不合格单号: </lable>
		    	    <div class="col-xs-7"style="padding-left:0px">
		    	    <input type="text" data-role="maskedtextbox"  disabled style="float:left;width:220px;height:30px"data-bind="value:model.noNum" class="k-textbox">	
		    	    </div>	    	 
		    </div>
		    <div class="col-sm-3">
		    	  <lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">工厂:  </lable>
		    	  <div class="col-xs-7"style="padding-left:0px">
                   <input  id="plantLov" style="width:220px;" required data-bind="value:model.plantId,text:model.plantCode" > 
                   </div>   		  		 
		    </div>
		    <div class="col-sm-3">
		    	 <lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">物料: </lable>
		    	 <div class="col-xs-7"style="padding-left:0px">
		 		 <input  id="itemLov" style="width:220px;"  data-bind="value:model.itemId,text:model.itemCode" >
		 		 </div>
		    </div>
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">物料描述:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		    	<input  id="itemdesc" data-role="maskedtextbox" style="width:220px;height:30px" disabled data-bind="value:model.itemDescriptions">
		    	
		    	</div>
		    </div>
    </div>
    <div class="row" style="margin-top: 10px;margin-right:6%;font-size:14px;font-style:initial">
         	<div class="col-sm-3">
    			<lable class="col-xs-4 control-lable"   style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">来源类型:</lable>
    			<div class="col-xs-7"style="padding-left:0px">
		    	<input id="nosourcetypeComBox" style="width:220px;"required data-bind="value:model.noSourceType">	    	
		    	<script>
    				
	    				$("#nosourcetypeComBox").kendoComboBox({
					        dataTextField: "meaning",
					        dataValueField: "value",
					        valuePrimitive: true,
					        dataSource: hqmNonconformingSource
						});
    				</script>
    				</div>
		    </div>
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">样本数量:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="sampleSize" style="width:220px;height:30px" data-bind="value:model.sampleSize" >
		  		</div>
		    </div>
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">批次:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		 		 <input  id="productionbatch" style="width:220px;height:30px" data-bind="value:model.productionBatch" >
		 		 </div>
		    </div>
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px"> 生产时间:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		    	<input  id="receiveDatePicker" data-role="datetimepicker" style="width:220px;"  data-bind="value:model.receiveDate">
		    	</div>
		    	<script type="text/javascript">
						$("#receiveDatePicker").kendoDateTimePicker({
							format: "yyyy-MM-dd HH:mm:ss",
							change:function(){
								viewModel.model.receiveDate = this.value().format("yyyy-MM-dd hh:mm:ss");
							}
						});
					</script>
		    </div>	
		   
    </div>
    <div class="row" style="margin-top: 10px;margin-right:6%;font-size:14px;font-style:initial">
    	   <div class="col-sm-3">
    			<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">来源检验单:</lable>
    			<div class="col-xs-7"style="padding-left:0px">
		    	<input  id=inspectionCode style="width:220px;height:30px" disabled data-bind="value:model.inspectionCode" > 
		    	</div>
		    </div>
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">检验日期:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="inspectionDatePicker" data-role="datetimepicker" style="width:220px ;"  data-bind="value:model.inspectionDate">
		  		</div>
		  		<script type="text/javascript">
						$("#inspectionDatePicker").kendoDateTimePicker({
							format: "yyyy-MM-dd HH:mm:ss",
							change:function(){
								viewModel.model.inspectionDate = this.value().format("yyyy-MM-dd hh:mm:ss");
							}
						});
					</script>
		    </div>
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">总数:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="totalityQty" style="width:220px;height:30px" data-bind="value:model.totalityQty" >
		  		</div>
		    </div>	
		
		    <div class="col-sm-3">
    			<lable class="col-xs-4 control-lable"  style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">检验类型:</lable>
    			<div class="col-xs-7"style="padding-left:0px">
		    	<input  id="inspectionTypeComBox" style="width:220px;"required data-bind="value:model.inspectionType" > 
		    		<script>
	    				$("#inspectionTypeComBox").kendoComboBox({
					        dataTextField: "meaning",
					        dataValueField: "value",
					        valuePrimitive: true,
					        dataSource: hqmIqcInspectionType
						});
    				</script>
    				</div>
		    </div>
    </div>
           
    <div class="row" style="margin-top: 10px;margin-right:6%;font-size:14px;font-style:initial">
         <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable"  style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">不良代码组:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="nggroupIdLov" style="width:220px;" data-bind="value:model.ngGroupId" > 
		  		</div>
		    </div>	
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">代码组名称:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="nggroupname" style="width:220px;height:30px" disabled data-bind="value:model.ngGroupName" >
		  		</div> 
		    </div>	
    		  
            <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable"  style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">处理单状态:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="noStatusComBox" style="width:220px;"disabled data-bind="value:model.noStatus" > 
		  		<script>
	    				$("#noStatusComBox").kendoComboBox({
					        dataTextField: "meaning",
					        dataValueField: "value",
					        valuePrimitive: true,
					        dataSource: hqmNoStatus
						});
	    				viewModel.model.noStatus="0";
    				</script>
    				</div>
		    </div>	
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">处理方法:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="nonconformingRateComBOX" style="width:220px;" data-bind="value:model.dealMethod" >
		  		
		  		<script>
    				
	    				$("#nonconformingRateComBOX").kendoComboBox({
					        dataTextField: "meaning",
					        dataValueField: "value",
					        valuePrimitive: true,
					        dataSource: hqmNoDealMethod
						});
    				</script>
    				</div>
		    </div>		
    </div>
    <div class="row" style="margin-top: 10px;margin-right:6%;font-size:14px;font-style:initial">
    		   
		    <div class="col-sm-3">
    			<lable class="col-xs-4 control-lable"  style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">不良代码编码:</lable>
    			<div class="col-xs-7"style="padding-left:0px">
		    	<input  id="ngmenberIdLov" style="width:220px;" data-bind="value:model.ngMenberId" > 
		    	</div>
		    </div>
		    <div class="col-sm-3">
		    
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">不良原因:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="ngreason" style="width:220px;height:30px" disabled data-bind="value:model.ngReason"> 
		  		</div>
		    </div>
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">不良现象:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="ngapparence" style="width:220px;height:30px" disabled data-bind="value:model.ngAppearance"> 
		  		</div>
		    </div>
		
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">处理日期:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="dealDatePicker" data-role="datetimepicker" style="width:220px;"  data-bind="value:model.dealDate">
		  		</div>
		  		<script type="text/javascript">
						$("#dealDatePicker").kendoDateTimePicker({
							format: "yyyy-MM-dd HH:mm:ss",
							change:function(){
								viewModel.model.dealDate = this.value().format("yyyy-MM-dd hh:mm:ss");
							}
						});
					</script>
		    </div>		
    </div>
      <div class="row" style="margin-top: 10px;margin-right:6%;font-size:14px;font-style:initial">
            
		    <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">检验员:</lable>
		    	<div class="col-xs-7"style="padding-left:0px">
		  		<input  id="approvalId" style="width:220px;" data-bind="value:model.approvalId,text:model.userName" > 
		  		
		  		</div>
		    </div>	
    	 	
		    
    </div>

    
     
       <div class="row" style="margin-top: 10px;margin-right:6%;font-size:14px;font-style:initial">
       
    		 <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">备注:</lable>	
		    	<div class="col-xs-7"style="padding-left:0px">
		    	<input  id="remark"  style="width:732%;" data-bind="value:model.remark" > 	
		    	</div>
		    		  		
		    </div>
		  
    </div>
       <div class="row" style="margin-top: 10px;margin-right:6%;font-size:14px;font-style:initial">
       
    		 <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">不合格描述:</lable>	
		    	<div class="col-xs-7"style="padding-left:0px">
		    	<textarea id="approvalDesArea" name="textarea" style="width:732%;"data-bind="value:model.approvalDes"></textarea>
    			</div>
    			<script>
                	$("#approvalDesArea").kendoTextArea({
                    });
                </script>
		    		  		
		    </div>
		  
    </div>
    <div class="row" style="margin-top: 10px;margin-right:6%;font-size:14px;font-style:initial">
       
    		 <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">其他部门意见:</lable>	
		    	<div class="col-xs-7"style="padding-left:0px">
		    	<textarea id="approvalDesArea1" name="textarea" style="width:732%;"data-bind="value:model.approvalDepartment1"></textarea>
    			</div>
    			<script>
                	$("#approvalDesArea1").kendoTextArea({
                    });
                </script>
		    		  		
		    </div>
		  
    </div>
    <div class="row" style="margin-top: 10px;margin-right:6%;font-size:14px;font-style:initial">
       
    		 <div class="col-sm-3">
		    	<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">质量部门意见:</lable>	
		    	<div class="col-xs-7"style="padding-left:0px">
		    	<textarea id="approvalDesArea2" name="textarea" style="width:732%;"data-bind="value:model.approvalDepartment2"></textarea>
    			</div>
    			<script>
                	$("#approvalDesArea2").kendoTextArea({
                    });
                </script>
		    		  		
		    </div>
		  
    </div>
    <div class="row" style="margin-top: 10px;margin-right:6%;font-size:14px;font-style:initial">
    	   <div class="col-sm-3"style="padding-left:0px;">
    				<lable class="col-xs-4 control-lable" style="text-align:right;padding:0px;padding-top:3px;padding-right:10px">审核意见:</lable>	
    			<div class="col-xs-7"style="padding-left:0px">
    				<div id="approvalResultRadio" style="margin-top:5px;" data-bind="enabled: isEnabled,value:model.approvalResult"></div>
    			</div>	
    				<script>
                                $("#approvalResultRadio").kendoRadio({
                                    layout: '',//vertical
                                    readonly: false,
                                    items: [{
                                        label: '<span style="color:green;">同意</span>',
                                        value: "OK"
                                    }, {
                                        label: '<span style="color:red;">拒绝</span>',
                                        value: "NG"
                                    }],
                                    change: function (e) {
                                    }
                                });
                                //$("#grid").data('kendoGrid')
//                                 kendo.bind($("#radio"), viewModel);
//                                 var radio=$("#radio").data('kendoRadio');
                            </script>
    			</div>
    		</div>
    
<div id="" style="clear:both" >
	<div id="gridLine"></div>
</div>
    
    
</div>


<script type="text/javascript">
kendo.bind($("#page-content"),viewModel);
$("#plantLov").kendoLov($.extend
	    (<@lov"LOV_PLANT"/>, {
	        textField: 'plantCode',
	        valueField:'plantId',
	    }));
$("#itemLov").kendoLov($.extend
	    (<@lov"LOV_ITEM"/>, {
	        textField: 'itemCode',
	        valueField:'itemId',
	        change:function() {
                var v = this.value();
                if (v == undefined  || v == ""){

                }else{
                	//document.getElementById("Descriptions").innerHTML = this._dataItem.itemDescriptions;
                	viewModel.model.set("itemDescriptions",this._dataItem.itemDescriptions);
            }
                
	    }}));
   $("#SupplierLov").kendoLov($.extend
                	    (<@lov"LOV_SUPPLIER"/>, {
                	        textField: 'supplierCode',
                	        valueField:'supplierId',
                	        change:function() {
                                var v = this.value();
                                if (v == undefined  || v == ""){

                                }else{
                                //	document.getElementById("SupplierName").innerHTML = this._dataItem.supplierName;
                                	viewModel.model.set("SupplierName",this._dataItem.supplierName);
                            }
                	    }}));

   $("#nggroupIdLov").kendoLov($.extend
   	    (<@lov"lOV_NG_GROUP"/>, {
   	        textField: 'ngGroupId',
   	        valueField:'ngGroupCode',
   	        change:function() {
                   var v = this.value();
                   if (v == undefined  || v == ""){

                   }else{     
                   	  viewModel.model.set("ngGroupName",this._dataItem.ngGroupName);
               }
   	    }}));	 
   $("#ngmenberIdLov").kendoLov($.extend
  		    (<@lov"LOV_NG_CODE"/>, {
  		        textField: 'ngMenberId',
  		        valueField:'ngCode',
  		      	query: function (e) {
		        	if(viewModel.model.ngGroupId == ''|| viewModel.model.ngGroupId == undefined||viewModel.model.ngGroupId == null){
	                	e.param['ngGroupId'] = 0;
		        	}else{
		        		e.param['ngGroupId'] = viewModel.model.ngGroupId;
		        	}
	            },
  		        change:function() {
                    var v = this.value();
                    if (v == undefined  || v == ""){
                    }else{     
                    	viewModel.model.set("nonconformingDesc",this._dataItem.ngAppearance);
                    	viewModel.model.set("ngReason",this._dataItem.ngReason);
                }
    	    }}));
   
   $("#approvalId").kendoLov($.extend
		    (<@lov"user_lov"/>, {
		        textField: 'userName',
		        valueField:'userId',
		    }));	
    	
</script>
<script type="text/javascript">
Hap.initEnterQuery('#query-form', viewModelLine.query);
var BaseUrl = _basePath;
dataSource = new kendo.data.DataSource({
    transport: {
        read: {
            url: BaseUrl + "/hqm/pqc/inspection/c/selectfornon",
            type: "POST",
            dataType: "json"
        },
        update: {
            url: BaseUrl + "/hqm/pqc/inspection/l/submit",
            type: "POST",
            contentType: "application/json"
        },
        destroy: {
            url: BaseUrl + "/hqm/pqc/inspection/l/remove",
            type: "POST",
            contentType: "application/json"
        },
        create: {
            url: BaseUrl + "/hqm/pqc/inspection/l/submit",
            type: "POST",
            contentType: "application/json"
        },
        parameterMap: function (options, type) {
            if (type !== "read" && options.models) {
                var datas = Hap.prepareSubmitParameter(options, type);
                for(var i=0;i<datas.length;i++){
                	datas[i].headerId = viewModel.model.headerId;
                }
                return kendo.stringify(datas);
            } else if (type === "read") {
            	//viewModelLine.model.inspectionStatus = "INPUT";
            	viewModelLine.model.headerId = viewModel.model.headerId;//头ID赋值查询
            	//changePicture();
            	return Hap.prepareQueryParameter(viewModelLine.model.toJSON(), options)
            }
        }
    },
    batch: true,
    serverPaging: true,
    pageSize: 30,
    schema: {
        data: 'rows',
        total: 'total',
        model: {
            id: "lineId",
            fields: {
            	inspectionStatus:{
            		defaultValue:"0",
            	},
            	inspectionDate:{
            		type:"date"
            	}
            },
            editable:function(col){
            	if(col=="itemCode"||col=="inspectionStatus"||col=="inspectionDate"||col=="inspectionResult"){
            		return false;
            	}
            	return true;
            }
        }
    }
});

var gridLine = $("#gridLine").kendoGrid({
    dataSource: dataSource,
    resizable: true,
    scrollable: true,
    navigatable: false,
    selectable: 'multiple, rowbox',
   /*  dataBound: function () {
        if (parent.autoResizeIframe) {
            parent.autoResizeIframe('${RequestParameters.functionCode!}')
        }
        changePicture();
        var width1 = $(".k-grid-content-locked").width();
		var width2 = $(".k-grid-content.k-auto-scrollable").width();
        if(!initFlag && hideFlag){		
			$("#hide").hide();
			$("#expand").show();
			$("#hideBtn").hide();
			//锁定列style设置
			$(".k-grid-content-locked").removeAttr('style');
			var str1 = 'width:'+ width1 +'px;height:'+(heightGrid+hideHeight)+'px';
			$(".k-grid-content-locked").attr('style',str1);
			//未锁定列style设置
			$(".k-grid-content.k-auto-scrollable").removeAttr('style');
			var str2 = 'width:'+ width2 +'px;height:'+(heightGrid+hideHeight)+'px';
			$(".k-grid-content.k-auto-scrollable").attr('style',str2);
		}else if(!initFlag && !hideFlag){
			$("#hide").show();
			$("#expand").hide();
			$("#hideBtn").show();
			//锁定列style设置
			$(".k-grid-content-locked").removeAttr('style');
			var str1 = 'width:'+ width1 +'px;height:'+(heightGrid)+'px';
			$(".k-grid-content-locked").attr('style',str1);
			//未锁定列style设置
			$(".k-grid-content.k-auto-scrollable").removeAttr('style');
			var str2 = 'width:'+ width2 +'px;height:'+(heightGrid)+'px';
			$(".k-grid-content.k-auto-scrollable").attr('style',str2);
		}
    }, */
    pageable: {
        pageSizes: [5, 10, 20, 50],
        refresh: true,
        buttonCount: 5
    },
/*     toolbar: [
    	{
            template: '<span id="createButton" class=" btn btn-primary">新增</span>'
        }, {
            template: '<span id="deleteButton" class="btn btn-danger">删除</span>'
        },
        {
            template: '<span id="saveButton" class="btn btn-primary">保存</span>'
        },
//         {
//             template: '<span id="inspectButton" class="btn btn-success">检验项目</span>'
//         },
    ], */
    columns: [
    	{
            field: "inspectionAttributeType",
            title: '<@spring.message "inspectionattribute.attributetype"/>',//检验项类型 from lookup_code: HQM_ATTRIBUTE_CATEGORY
            width: 120,
            template: function (dataItem) {
                var v = dataItem.inspectionAttributeType ? dataItem.inspectionAttributeType : "";
                $.each(hqmIqcAttributeCategory, function (i, n) {
                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                        v = n.meaning;
                        return v;
                    }
                });
                return v;
            }
        },
    	{
            field: "inspectionAttribute",
            title: '<@spring.message "inspectionattribute.inspectionattribute"/>',//检验项名称
            width: 120,
            editor: function (container, options) {
                // $('<span>'+options.model.itemDescriptions+'</span>')
                //     .appendTo(container);
                $('<span data-bind="text:inspectionAttribute"></span>').appendTo(container);
            }
        },
        
        {
            field: "standardType",
            title: '<@spring.message "inspectionattribute.standardtype"/>',//规格类型from lookup_code: HQM_STANDARD_TYPE
            width: 120,
            template: function (dataItem) {
                var v = dataItem.standardType ? dataItem.standardType : "";
                $.each(hqmIqcStandardType, function (i, n) {
                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                        v = n.meaning;
                        return v;
                    }
                });
                return v;
            },
            editor: function (container, options) {
                $('<input disabled name="' + options.field + '"/>')
                    .appendTo(container)
                    .kendoDropDownList({
                        dataTextField: "meaning",
                        dataValueField: "value",
                        valuePrimitive: true,
                        dataSource:hqmIqcStandardType
                    });
            }
        },
        {
            field: "sampleType",
            title: '<@spring.message "iqcinspectionl.sampleWayId"/>',//抽样方式
            width: 150,
            template: function (dataItem) {
            	sampleType = dataItem.sampleType + '';
                var v = sampleType ? sampleType : "";
                $.each(HQM_SAMPLE_TYPE, function (i, n) {
                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                        v = n.meaning;
                        return v;
                    }
                })
                return v;
            },
        },
        {
            field: "sampleQty",
            title: '<@spring.message "pqcinspectionc.sampleqty"/>',//抽样数量
            width: 120
        },
        {
            field: "standradFrom",
            title: '<@spring.message "pqcinspectionc.standradfrom"/>',//规格值上限
            width: 120,
           
            	
            },
           
                {
            field: "standradTo",
            title: '<@spring.message "pqcinspectionc.standradto"/>',//规格值下限
            width: 120,
           
           
        },
        {
            field: "standradUom",
            title: '<@spring.message "pqcinspectionc.standraduom"/>',//规格单位
            width: 120,
            template: function (dataItem) {
                var v = dataItem.standradUom ? dataItem.standradUom : "";
                $.each(hqmStandradUom, function (i, n) {
                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                        v = n.meaning;
                        return v;
                    }
                })
                return v;
            },
        },
        {
            field: "textStandrad",
            title: '<@spring.message "pqcinspectionc.textstandrad"/>',//文本规格值
            width: 320
        },
        {
            field: "inspectionMethod",
            title: '<@spring.message "iqcinspectionl.inspectionMethod"/>',//检验方法
            width: 120,
            
        },  
        {
            field: "inspectionTool",
            title: '<@spring.message "inspectionattribute.inspectiontool"/>',//检验工具
            width: 120,
            template:function(item){
            	return '<span style="background-color:white;">'+item.inspectionTool+'<span>';
            },
            editor: function (container, options) {
            	$('<span data-bind="text:inspectionTool"></span>').appendTo(container);
            }
        }, 
        {
            field: "fillInType",
            title: '<@spring.message "inspectionattribute.fillintype"/>',//填写类型 from lookup_code:hqm_fill_in_type
            width: 120,
            template: function (dataItem) {
                var v = dataItem.fillInType ? dataItem.fillInType : "";
                $.each(hqmFillInType, function (i, n) {
                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                        v = n.meaning;
                        return v;
                    }
                });
                return v;
            },
            editor: function (container, options) {
                $('<input disabled name="' + options.field + '"/>')
                    .appendTo(container)
                    .kendoDropDownList({
                        dataTextField: "meaning",
                        dataValueField: "value",
                        valuePrimitive: true,
                        dataSource:hqmFillInType
                    });
            }
        },
          
        {
            field: "precision",
            title: '<@spring.message "iqcinspectionl.precision"/>',//精度
            width: 140
        },  

        {
            field: "inspectionHistory",
            title: '<@spring.message "iqcinspectionl.inspectionhistory"/>',//检验记录 多input记录输入  头表的抽样数量决定多少
            width: 500,
            template:function(item){
            	return item['inspectionHistory']?item['inspectionHistory']:'';
            }
          
        },
        {
            field: "attributeInspectionRes",
            title: '<@spring.message "pqcinspectionc.attributeinspectionres"/>',//结论
            width: 120,
            editor: function (container, options) {
                // $('<span>'+options.model.itemDescriptions+'</span>')
                //     .appendTo(container);
                $('<span data-bind="text:attributeInspectionRes"></span>').appendTo(container);
            }
        },
        {
            field: "conformingQty",
            title: '<@spring.message "pqcinspectionc.conformingqty"/>',//合格数
            width: 120,
            editor: function (container, options) {
                // $('<span>'+options.model.itemDescriptions+'</span>')
                //     .appendTo(container);
                $('<span data-bind="text:conformingQty"></span>').appendTo(container);
            }
        },
        {
            field: "nonConformingQty",
            title: '<@spring.message "pqcinspectionc.nonconformingqty"/>',//不良数
            width: 120,
            editor: function (container, options) {
                // $('<span>'+options.model.itemDescriptions+'</span>')
                //     .appendTo(container);
                $('<span data-bind="text:nonConformingQty"></span>').appendTo(container);
            }
        },
              
                {
            field: "remark",
            title: '<@spring.message "pqcinspectionc.remark"/>',//备注
            width: 120
        },
    ],
    editable: false
}).data("kendoGrid");

</script>
<script>
	$('#deleteButton').on('click', function () {
		var selected = $("#gridLine").data("kendoGrid").selectedDataItems();
		$.each(selected,function(i,v){
			if(v.inspectionStatus=="2"){
				kendo.ui.showErrorDialog({message:"已完成的不能删除"});
				return;
			}
			$("#gridLine").data("kendoGrid").dataSource.remove(v);
			$("#gridLine").data("kendoGrid").dataSource.sync("destroy");
		});
	});
	$('#createButton').on('click', function () {
		$("#gridLine").data("kendoGrid").addRow();
	});
	$('#saveButton').on('click', function () {
		viewModelLine.save();
	});
	
</script>
<script>
	$(function (){
		$("#gridLine").height(window.innerHeight*40/100);
		//getInspectionInfo();
		/* if(pageFlag == "INPUT"){
			$("#btnSave").show();
			$("#btnCommit").show();
		}
		else if(pageFlag == "CREATE"){
			$("#btnSave").show();
			$("#btnCommit").show();
		}
		else if(pageFlag == "AUDIT"){
			$("btnSponsor").show();
			$("#btnSave").show();
			$("#btnGetdisqualification").show();
			$("#btnAudit").show();
	        $("#createButton").hide();
	        $("#deleteButton").hide();
	        $("#saveButton").hide();
	        $("#inspectButton").hide();
		}
		else{
			$("#btnSave").show();
			$("#btnCommit").show();
			//$("#btnGetdisqualification").show();
			$("#btnAudit").show();
		}
		changePicture(); */
	});
	
</script>
<script>
var pageNumber = 1;
function pageTwo(){
	var columns = gridLine.columns.length;
	for(var columnIndex=columns-1;columnIndex>9;columnIndex--){
		gridLine.hideColumn(columnIndex);
	}
	for(var columnIndex=3;columnIndex<=9;columnIndex++){
		gridLine.showColumn(columnIndex);
	}
}
function pageOne(){
	var columns = gridLine.columns.length;
	for(var columnIndex=3;columnIndex<=9;columnIndex++){
		gridLine.hideColumn(columnIndex);
	}
	for(var columnIndex=columns-1;columnIndex>9;columnIndex--){
		gridLine.showColumn(columnIndex);
	}
}
function togglePage(){
	var columns = gridLine.columns.length;
	if(pageNumber == 0){
		for(var columnIndex=3;columnIndex<=9;columnIndex++){
			gridLine.showColumn(columnIndex);
		}
		for(var columnIndex=columns-1;columnIndex>9;columnIndex--){
			gridLine.hideColumn(columnIndex);
		}
		pageNumber = 1;
	}else{
		for(var columnIndex=columns-1;columnIndex>9;columnIndex--){
			gridLine.showColumn(columnIndex);
		}
		for(var columnIndex=3;columnIndex<=9;columnIndex++){
			gridLine.hideColumn(columnIndex);
		}
		pageNumber = 0;
	}
}
</script>
</body>
</html>