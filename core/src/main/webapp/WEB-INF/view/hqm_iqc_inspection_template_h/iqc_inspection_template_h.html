<#include "../include/header.html">
    <!-- 
tianmin.wang:2019-07-18
 -->
    <script src="${base.contextPath}/common/code?yesNo=SYS.YES_NO"></script>
    <script src="${base.contextPath}/common/code?hqmIqcItemCategory=HQM_IQC_ITEM_CATEGORY"></script>
    <script src="${base.contextPath}/common/code?hqmInspectionTemplateStatus=HQM_INSPECTION_TEMPLATE_STATUS"></script>
    <script src="${base.contextPath}/common/code?hqmIqcEnableType=HQM_IQC_ENABLE_TYPE"></script>
    <script src="${base.contextPath}/common/code?hqmStandradUom=HQM_STANDARD_UOM"></script>
    <script src="${base.contextPath}/common/code?hqmIqcFillInType=HQM_FILL_IN_TYPE"></script>
    <script src="${base.contextPath}/common/code?hqmIqcSampleStandardType=HQM_IQC_SAMPLE_STANDARD_TYPE"></script>
    <script src="${base.contextPath}/common/code?hqmIqcIinspectionLevels=HQM_IQC_INSPECTION_LEVELS"></script>
    <script src="${base.contextPath}/common/code?hqmIqcQualityGrade=HQM_IQC_QUALITY_GRADE"></script>
    <script src="${base.contextPath}/common/code?hqmIqcAql=HQM_IQC_AQL"></script>
    <script src="${base.contextPath}/common/code?hqmIqcSourceType=HQM_IQC_SOURCE_TYPE"></script>
    <script src="${base.contextPath}/common/code?hqmIqcAttributeCategory=HQM_IQC_ATTRIBUTE_CATEGORY"></script>
    <script src="${base.contextPath}/common/code?hqmIqcStandardType=HQM_IQC_STANDARD_TYPE"></script>
    <script src="${base.contextPath}/common/code?hqmIqcFrequencyType=HQM_IQC_FREQUENCY_TYPE"></script>
    <script src="${base.contextPath}/common/code?HQM_SOURCE_TYPE_TEMP=HQM_SOURCE_TYPE_TEMP"></script>
    <script type="text/javascript">
        var viewModel = Hap.createGridViewModel("#grid");
        //同步
        viewModel.operationSynchronized = function() {
                kendo.ui.showWarningDialog({
                    message: '逻辑未实现'
                });
            }
            //更新提醒
        viewModel.operationInfo = function() {
                kendo.ui.showWarningDialog({
                    message: '逻辑未实现'
                });
            }
            //发布
        viewModel.operationIssue = function() {
            var opFlag = true;
            var data = grid.selectedDataItems();
            if (data == undefined || data == null || data.length == 0) {
                kendo.ui.showWarningDialog({
                    message: '请选择要发布的数据'
                });

                return;
            }
            $.each(data, function(i, n) {
                if (n.status != '3') {
                    opFlag = false;
                    kendo.ui.showWarningDialog({
                        message: '<@spring.message "error.iqc.template.issue.error1001"/>'
                    });
                    return;
                }
            });
            $.each(data, function(i, n) {
                if (n.enableFlag == 'N') {
                    opFlag = false;
                    kendo.ui.showWarningDialog({
                        message: '只能对有效的进行发布'
                    });
                    return;
                }
            });
            //进行发布请求
            if (!opFlag) return;
            $.ajax({
                url: '${base.contextPath}/hqm/iqc/inspection/template/h/issue',
                type: 'POST',
                data: JSON.stringify(data),
                async: false,
                contentType: "application/json",
                dataType: "json",
                success: function(response) {
                    if (response.success) {
                        grid.dataSource.fetch();
                        kendo.ui.showInfoDialog({
                            message: '发布成功'
                        });
                    } else {
                        kendo.ui.showWarningDialog({
                            message: response.message
                        });
                    }
                }
            });
        }
    </script>
    <script>
        var mainType = '${RequestParameters.mainType!"IQC"}';
        var viewModelLine = Hap.createGridViewModel("#gridLine");
        //新建
        var enableTypeFlag = "";
        viewModelLine.create = function() {
                //var row = grid.select();
                //var data = grid.dataItem(row);
                var data = grid.selectedDataItems();
                if (data == undefined || data == null || data.length == 0) {
                    kendo.ui.showWarningDialog({
                        message: '未选择主(头)数据!'
                    });
                    return;
                }
                if (viewModelLine.model.headerId == null || viewModelLine.model.headerId == undefined || viewModelLine.model.headerId == '') {
                    kendo.ui.showWarningDialog({
                        message: '主(头)数据未保存'
                    });
                    return;
                }
                enableTypeFlag = "D";
                gridLine.addRow();
                gridLine.dataSource.data()[0].set('enableType', 'D');
                enableTypeFlag = '';
            }
            //保存
        viewModelLine.save = function() {
                var data = grid.selectedDataItems();
                if (data == undefined || data == null || data.length == 0) {
                    kendo.ui.showWarningDialog({
                        message: '未选择主(头)数据!'
                    });
                    return;
                }
                gridLine.saveChanges();
            }
            //另加检验项目
        viewModelLine.plusFunction = function() {
            var data = grid.selectedDataItems();
            if (data == undefined || data == null || data.length == 0) {
                kendo.ui.showWarningDialog({
                    message: '未选择主(头)数据!'
                });
                return;
            }
            if (viewModelLine.model.headerId == null || viewModelLine.model.headerId == undefined || viewModelLine.model.headerId == '') {
                kendo.ui.showWarningDialog({
                    message: '主(头)数据未保存'
                });
                return;
            }
            enableTypeFlag = "T"
            gridLine.addRow();
            gridLine.dataSource.data()[0].set('enableType', 'T');

        }
        viewModelLine.copyFunction = function() {
            kendo.ui.showWarningDialog({
                message: '逻辑未实现'
            });
        }
    </script>
    <script>
        function ifNotNull(e) {
            if (e != null && e != undefined && e != '') {
                return true;
            }
            return false;
        }

        function getDataSource(uri, value) {
            var array = new Array();
            $.ajax({
                url: _basePath + uri,
                type: "GET",
                dataType: "json",
                data: {
                    value: value
                },
                async: false,
                success: function(data) {
                    if (data.success) {
                        array = data.rows;
                    } else {

                    }
                }
            });
            return array;
        }

        function openDetail(headerId) {
            var dialog = $("#detailWindow").kendoWindow({
                actions: ["Close"],
                width: 1500,
                height: 700,
                title: '<@spring.message "iqcinspectiontemplate.inspection_template_detail"/>', //检验计划明细
                content: './create_or_detail.html?jumpFlag=DETAIL&&headerId=' + headerId + '&&mainType=' + mainType,
                iframe: true,
                visible: false,
                resizable: false,
                modal: true,
                close: function() {
                    grid.dataSource.fetch();
                }
            }).data("kendoWindow");
            dialog.center().open();
        }
        function openVtpDetail(headerId,vtpNumber){
        	var dialog = $("#vtpDetailWindow").kendoWindow({
                actions: ["Close"],
                width: 1500,
                height: 700,
                title: 'VTP明细',
                content: './vtp_create_or_detail.html?jumpFlag=DETAIL&headerId=' + headerId + '&mainType=' + mainType + '&vtpNumber=' + vtpNumber,
                iframe: true,
                visible: false,
                resizable: false,
                modal: true,
                close: function() {
                    grid.dataSource.fetch();
                }
            }).data("kendoWindow");
            dialog.center().open();
        }
    </script>
    <script>
        viewModel.create = function() {
            var dialog = $("#childrenWindow").kendoWindow({
                actions: ["Close"],
                width: 1500,
                height: 700,
                title: '<@spring.message "iqcinspectiontemplate.create_new_inspection_plan"/>', //新建检验计划
                content: './create_or_detail.html?jumpFlag=NEW&&mainType=' + mainType,
                iframe: true,
                visible: false,
                resizable: false,
                modal: true,
                close: function() {
                    grid.dataSource.fetch();
                }
            }).data("kendoWindow");
            dialog.center().open();
        }
        viewModel.exportFunction = function() {
            Hap.blockUI({
                message: 'Exporting...',
                target: 'body',
                boxed: true,
            });
            var $inputImg = $('<input/>').attr({
                name: "dto",
                value: kendo.stringify(viewModel.model.toJSON())
            });
            var $inputToken = $('<input/>').attr({
                name: "${_csrf.parameterName}",
                value: "${_csrf.token}",
                type: "hidden"
            });
            //   var $inputSubmitBtn=$('<input>').attr({type:"submit",value:"submit"});
            var $form = $("<form  method='post'></form>");
            $form.attr({
                target: '_self',
                method: 'post',
                action: '${base.contextPath}/hqm/iqc/inspection/template/h/exportexcel'
            }).append($inputImg);
            $form.append($inputToken);
            $("#submitDiv").append($form);
            $($form).submit();
            Hap.unblockUI('body');
        }
        
        viewModel.inportFunction = function() {//导入 kai.li 2020年2月27日
        	var newModelWindow = $('#excelimport').kendoWindow({
                title: '<@spring.message "hap.import"/>',//导入
                width: 500,
                height: 300,
                modal: true,
                close: function() {
                    $('#grid').data('kendoGrid').dataSource.read();
                } 
            }).data('kendoWindow');
        	newModelWindow.center().open();
        }
        
        viewModel.commit = function() { //提交 added by wtm 20200203
        	var opFlag = true;
            var data = grid.selectedDataItems();
            if(data.length == 0){
            	return;
            }
            $.each(data, function(i, n) {
            	console.log(n);
                if(n.status != '1'){
                	kendo.ui.showInfoDialog({
                        message: '<@spring.message "error.iqc.template.commit.error1001"/>'
                    });
                	opFlag = false;
                	return false;
                }
            });
            //进行提交请求
            if (!opFlag) return;
            $.ajax({
                url: '${base.contextPath}/hqm/iqc/inspection/template/h/commit',
                type: 'POST',
                data: JSON.stringify(data),
                async: false,
                contentType: "application/json",
                dataType: "json",
                success: function(response) {
                    if (response.success) {
                        grid.dataSource.fetch();
                        kendo.ui.showWarningDialog({
                            message: '<@spring.message "audit.processful"/>'
                        });
                    } else {
                        kendo.ui.showWarningDialog({
                            message: response.message
                        });
                    }
                }
            });
        }
        viewModel.audit = function() { //审核 added by wtm 20200203
        	var opFlag = true;
            var data = grid.selectedDataItems();
            if(data.length == 0){
            	return;
            }
            $.each(data, function(i, n) {
                if(n.status != '2'){
                	kendo.ui.showInfoDialog({
                        message: '<@spring.message "error.iqc.template.audit.error1001"/>'
                    });
                	opFlag = false;
                	return false;
                }
            });
            //进行审核请求
            if (!opFlag) return;
            $.ajax({
                url: '${base.contextPath}/hqm/iqc/inspection/template/h/audit',
                type: 'POST',
                data: JSON.stringify(data),
                async: false,
                contentType: "application/json",
                dataType: "json",
                success: function(response) {
                    if (response.success) {
                        grid.dataSource.fetch();
                    } else {
                        kendo.ui.showWarningDialog({
                            message: response.message
                        });
                    }
                }
            });
        }
        viewModel.reback = function() { //退回 added by wtm 20200203
        	var opFlag = true;
            var data = grid.selectedDataItems();
            if(data.length == 0){
            	return;
            }
            $.each(data, function(i, n) {
                if(n.status != '2'){
                	kendo.ui.showInfoDialog({
                        message: '<@spring.message "error.iqc.template.reback.error1001"/>'
                    });
                	opFlag = false;
                	return false;
                }
            });
            //进行退回请求
            if (!opFlag) return;
            $.ajax({
                url: '${base.contextPath}/hqm/iqc/inspection/template/h/reback',
                type: 'POST',
                data: JSON.stringify(data),
                async: false,
                contentType: "application/json",
                dataType: "json",
                success: function(response) {
                    if (response.success) {
                        grid.dataSource.fetch();
                    } else {
                        kendo.ui.showWarningDialog({
                            message: response.message
                        });
                    }
                }
            });
        }
        viewModel.vtpFunction = function(){//VTP
    		var dialog = $("#vtpCreateWindow").kendoWindow({
    			width: 900,
    			height: 600,
                title: '二次VTP模板编制',
                visible: false,
                iframe: true,
                modal: true,
                content: './vtp_model_create.html?mainType=' + mainType
            }).data("kendoWindow");
    		dialog.center().open();
        }
        viewModel.importCategoryExcel = function(){
        	$("#categoryFiles").trigger("click")
        }
        function viewHis(relId){
        	var dialog = $("#hisWindow").kendoWindow({
        		width: 1500,
        		height: 700,
                title: '历史',
                visible: false,
                iframe: true,
                modal: true,
                content: '../hcm_object_events/inspection_template_oe.html?businessKeyId=' + relId
            }).data("kendoWindow");
            dialog.center().open();
        }
    </script>

    <body>
    	<div id="hisWindow" style="display:none;"></div>
        <div id="submitDiv" class="kendoWindow" style="display:none;"></div>
        <div id="detailWindow" class="kendoWindow" style="display:none;"></div>
        <div id="childrenWindow" class="kendoWindow" style="display:none;"></div>
        <div id="vtpCreateWindow" class="kendoWindow" style="display:none;"></div>
        <div id="vtpDetailWindow" class="kendoWindow" style="display:none;"></div>
        
        <div id="page-content">
            <div class="pull-left" id="toolbar-btn" style="padding-bottom:10px;">
                <span class="btn btn-primary k-grid-add" style="float:left;margin-right:5px;" data-bind="click:create">
                	<i class=" fa fa-plus-square"></i><@spring.message "hap.new"/></span>
                <span class="btn btn-success k-grid-save-changes" data-bind="click:save" style="float:left;margin-right:5px;">
                	<i class=" fa fa-check"></i><@spring.message "hap.save"/></span>
                <span class="btn btn-primary" data-bind="click:operationIssue" style="float:left;margin-right:5px;">
                	<i class=" fa fa-share"></i><@spring.message "hqm.qc.publish"/></span>
                <span class="btn btn-danger" style="float:left;margin-right:5px;" data-bind="click:remove">
                	<i class="fa fa-trash-o" style="margin-right:3px;"></i><@spring.message "hap.delete"/></span>
                <span id="exportexcel" class="btn btn-success " data-bind="click:exportFunction" style="float:left;margin-right:5px;">
                	<i class="fa fa-file-excel-o"></i><@spring.message "hap.exportexcel"/></span>
                <span id="inportexcel" class="btn btn-warning " data-bind="click:inportFunction" style="float:left;margin-right:5px;">
                	<i class="fa fa-file-excel-o"></i><@spring.message "hap.inportexcel"/></span>
                	
                	<span id="importCategoryExcel" class="btn btn-warning " data-bind="click:importCategoryExcel" style="float:left;margin-right:5px;">
                	<i class="fa fa-file-excel-o"></i><@spring.message "inspectiontempalteh.importcategoryexcel"/></span>
                <!-- 一期不用
        <span class="btn btn-success fa fa-repeat" data-bind="click:operationSynchronized" style="float:left;margin-right:5px;"><@spring.message "同步"/></span>
        <span class="btn btn-success fa fa-bell-o" data-bind="click:operationInfo" style="float:left;margin-right:5px;"><@spring.message "更新提醒"/></span>
         -->
         
                <span id="commit-btn" class="btn btn-warning" data-bind="click:commit" style="float:left;margin-right:5px;">
         			<i class="fa fa-hand-o-right"></i><@spring.message "hap.commit"/></span>
         		<span id="audit-btn" class="btn btn-primary" data-bind="click:audit" style="float:left;margin-right:5px;">
         			<i class="fa fa-check"></i><@spring.message "hap.audit"/></span>
         		<span id="reback-btn" class="btn btn-danger" data-bind="click:reback" style="float:left;margin-right:5px;">
         			<i class="fa fa-hand-o-left"></i><@spring.message "hap.reback"/></span>
         			
         			<span id="vtpFunction" class="btn btn-primary" data-bind="click:vtpFunction" style="float:left;margin-right:5px;">
         			<i class="fa fa-bullseye"></i>VTP</span>
            </div>
            <script>
                kendo.bind($('#toolbar-btn'), viewModel);
            </script>
            <div id="queryPanel" class="pull-right" style="margin-right:5px;padding-bottom:10px;">
                <div class="k-query-simple" id="query-form">
                    <input id="itemLov" placeholder="<@spring.message 'asliqccontrol.item'/>" data-bind="value:model.itemId">
                    <input id="plantLov" placeholder="<@spring.message 'asliqccontrol.plant'/>" data-bind="value:model.plantId">
                </div>
                <script>
                    kendo.bind($('#query-form'), viewModel);
                </script>
                <div class="k-query-detail" id="query-form2">
                    <div class="rows">
                        <!--  <input id="itemcategoryLov"  placeholder="<@spring.message 'iqcinspectiontemplateh.itemcategory'/>"
                       style="width:150px;" data-bind="value:model.itemCategory"> -->
                        <input id="statusComboBox" placeholder="<@spring.message 'iqcinspectiontemplateh.status'/>" style="width:150px;" data-bind="value:model.status">
                        <input id="enableflagComboBox" placeholder="<@spring.message 'iqcinspectiontemplateh.enableflag'/>" style="width:150px;" data-bind="value:model.enableFlag">

                    </div>
                </div>
                <script>
                    kendo.bind($('#query-form2'), viewModel);
                </script>
            </div>
            <div style="clear:both;width:100%;">
                <div id="grid"></div>
            </div>


        </div>
        <div style="display:none;clear:both;height:50%;width:100%;">
            <div id="gridLine"></div>
        </div>
        
        <div id="excelimport" style="display:none">
			<form id="mainform" class="form-horizontal">
			<div class="row" style="width:95%">
				<div class="form-group">
					<label class="col-sm-3 control-label"></label>
					<div class="col-sm-7">
					<div class="demo-section k-content">
						<input name="files" id="files1" type="file" accept=".xlsx" />
					</div>
		
					<script>
						$(document).ready(function() {
							var saveurl;
							if(mainType == "FQC") {
								saveurl = "${base.contextPath}/hqm/iqc/inspection/template/h/excelimportFqc?${_csrf.parameterName}=${_csrf.token}";
							} else {
								saveurl = "${base.contextPath}/hqm/iqc/inspection/template/h/excelimport?${_csrf.parameterName}=${_csrf.token}"
							}
							
							$("#files1").kendoUpload({
								async: {
		                        saveUrl: saveurl,
								autoUpload: true },
								upload : function(e){},
		                        success : function(e){
		                        	var response = e.response;
		                        	if(response.success){
		                        		kendo.ui.showInfoDialog({ message: response.message }).done(function (e) {
		                                        if(e.button=='OK'){
		                                        	window.$("#excelimport").data("kendoWindow").close();
		                                        	$("#grid").data('kendoGrid').dataSource.read();
		                                        }});
		                        	}else{
		                        		kendo.ui.showErrorDialog({ message: response.message }).done(function (e) {
		                                    	window.$("#excelimport").data("kendoWindow").close();
		                                    	self.location.reload();
		                                    	});
		                        	}
		                        },
								showFileList:true
							});
						});
						</script>
					</div>
				</div>
			</div>
			</form>
		</div>
        
        <div id="excelImportCategory" style="display: none;">
        <form class="form-horizontal">
			<div class="row" style="width:95%">
					<div class="col-sm-7">
					<div class="demo-section k-content">
						<input name="files" id="categoryFiles" type="file" accept=".xlsx" />
					</div>
					<script>
							$("#categoryFiles").kendoUpload({
								async: {
		                        saveUrl: "${base.contextPath}/hqm/iqc/inspection/template/h/excelimport/category/upload?${_csrf.parameterName}=${_csrf.token}",//
								autoUpload: true
								},
								upload: function(e){
									e.data = {
											mainType: mainType
								        }
						            Hap.blockUI({
						            	message: "导入中..."
						            });
								},
		                        success: function(e){
		                            Hap.unblockUI();
		                        	var response = e.response;
		                        	if(response.success){
		                        		//$("#grid").data("kendoGrid").dataSource.data(response.rows);
		                        		kendo.ui.showInfoDialog({message: "导入成功"});
		                        	}else{
		                        		kendo.ui.showErrorDialog({
		                                        message: response.message
		                                    });
		                        		
		                        	}
		                        },
								showFileList:false,
								});
						</script>
					</div>
			</div>
		</form>
    	</div>
        <script type="text/javascript">
            $('#queryPanel').kendoQueryPanel({
                queryFunction: function() {
                    viewModel.query();
                },
                resetFunction: function() {
                    viewModel.reset();
                }
            });
            $("#itemcategoryLov").kendoLov($.extend( <@lov "LOV_ITEM_CATEGORY" /> , {
                textField: 'categoryCode',
                valueField: 'categoryId',
            }));
            $("#statusComboBox").kendoComboBox({
                dataTextField: "meaning",
                dataValueField: "value",
                valuePrimitive: true,
                dataSource: hqmInspectionTemplateStatus
            });
            $("#enableflagComboBox").kendoComboBox({
                dataTextField: "meaning",
                dataValueField: "value",
                valuePrimitive: true,
                dataSource: yesNo
            });
            $("#itemLov").kendoLov($.extend( <@lov "LOV_ITEM" /> , {
                textField: 'itemCode',
                valueField: 'itemId',
            }));
            $("#plantLov").kendoLov($.extend( <@lov "LOV_PLANT" /> , {
                textField: 'plantCode',
                valueField: 'plantId',
            }));
            Hap.initEnterQuery('#query-form', viewModel.query);
            var BaseUrl = _basePath;
            dataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: BaseUrl + "/hqm/iqc/inspection/template/h/query",
                        type: "POST",
                        dataType: "json"
                    },
                    update: {
                        url: BaseUrl + "/hqm/iqc/inspection/template/h/submit",
                        type: "POST",
                        contentType: "application/json"
                    },
                    destroy: {
                        url: BaseUrl + "/hqm/iqc/inspection/template/h/remove",
                        type: "POST",
                        contentType: "application/json"
                    },
                    create: {
                        url: BaseUrl + "/hqm/iqc/inspection/template/h/submit",
                        type: "POST",
                        contentType: "application/json"
                    },
                    parameterMap: function(options, type) {
                        if (type !== "read" && options.models) {
                            var datas = Hap.prepareSubmitParameter(options, type)
                            return kendo.stringify(datas);
                        } else if (type === "read") {
                            viewModel.model.mainType = mainType;
                            return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                        }
                    }
                },
                batch: true,
                serverPaging: true,
                pageSize: 20,
                schema: {
                    data: 'rows',
                    total: 'total',
                    model: {
                        id: "headerId",
                        fields: {
                            versionNum: {
                                type: 'string',
                                validation: {
                                    required: true,
                                    required: {
                                        message: "版本号为必输项"
                                    },
                                },
                            },
                            enableFlag: {
                                type: 'boolean',
                                checkedValue: 'Y',
                                uncheckedValue: 'N'
                            },
                            columnCreationDate: {
                                type: 'date',

                            },
                            historyNum: {
                                type: 'number',
                                defaultValue: 10,
                            },
                            status: {
                                type: 'string',
                                defaultValue: '1',
                            },

                            sourceType: {
                                type: 'string',
                                validation: {
                                    required: true,
                                    required: {
                                        message: "来源类型为必输项"
                                    },
                                },
                            }
                        },
                        editable: function(column) {
                            if (column == 'enableFlag') {
                                return true;
                            }
                            return false;
                        }

                    }
                }
            });
        </script>
        <script>
            var redStr = "<span style=\'color:red;\'>*</span>";
            var grid = $("#grid").kendoGrid({
                dataSource: dataSource,
                resizable: true,
                scrollable: true,
                navigatable: false,
                selectable: 'multiple, rowbox',
                sortable: true,
                dataBound: function() {
                    gridLine.dataSource.data(new Array());
                    if (parent.autoResizeIframe) {
                        parent.autoResizeIframe('${RequestParameters.functionCode!}')
                    }
                },
                pageable: {
                    pageSizes: [5, 10, 20, 50],
                    refresh: true,
                    buttonCount: 5
                },
                columns: [

                    {
                        field: "plantCode",
                        title: '<@spring.message "hap.plant"/>', //工厂
                        width: 120,
                        template: function(Item) {
                            return Item['plantCode'] || ''
                        },
                        editor: function(container, options) {
                            $('<input name="' + options.field + '"/>')
                                .appendTo(container)
                                .kendoLov($.extend( <@lov "LOV_PLANT" /> , {
                                    query: function(e) {
                                        e.param['enableFlag'] = 'Y'
                                    },
                                    textField: 'plantCode',
                                    model: options.model,
                                    change: function() {
                                        var v = this.value();
                                        if (v == undefined || v == "") {
                                            options.model.set('plantCode', "");
                                            options.model.set('plantId', '')
                                        } else {
                                            options.model.plantCode = this._dataItem.plantCode;
                                            options.model.plantId = this._dataItem.plantId;
                                        }
                                    }
                                }));
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "itemCode",
                        title: '<@spring.message "hap.itemcode"/>', //物料编码
                        width: 120,
                        template: function(Item) {
                            return Item['itemCode'] || ''
                        },
                        editor: function(container, options) {
                            if (options.model.plantId == '' || options.model.plantId == undefined || options.model.plantId == null) {
                                $('<span style="background-color:#C43C8D;color:white;">未选择工厂</span>').appendTo(container);
                                return;
                            }
                            $('<input name="' + options.field + '"/>')
                                .appendTo(container)
                                .kendoLov($.extend( <@lov "LOV_ITEM" /> , {
                                    query: function(e) {
                                        e.param['enableFlag'] = 'Y'
                                        e.param['plantId'] = options.model.plantId;
                                    },
                                    textField: 'itemCode',
                                    model: options.model,
                                    change: function() {
                                        var v = this.value();
                                        if (v == undefined || v == "") {

                                        } else {
                                            options.model.itemCode = this._dataItem.itemCode;
                                            options.model.itemId = this._dataItem.itemId;
                                            options.model.set('itemDescriptions', this._dataItem.itemDescriptions);

                                        }
                                    }
                                }));
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "itemDescriptions",
                        title: '<@spring.message "hap.itemdescriptions"/>', //物料描述
                        editor: function(container, options) {
                            // $('<span>'+options.model.itemDescriptions+'</span>')
                            //     .appendTo(container);
                            $('<span data-bind="text:itemDescriptions"></span>').appendTo(container);
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }


                    }, {
                        field: "itemEdition",
                        title: '<@spring.message "iqcinspectiontemplateh.itemedition"/>', //物料版本
                        
                        editor: function(container, options) {
                            // $('<span>'+options.model.itemDescriptions+'</span>')
                            //     .appendTo(container);
                            $('<span data-bind="text:itemDescriptions"></span>').appendTo(container);
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }


                    }, {
                        field: "sourceType",
                        title: '<@spring.message "iqcinspectiontemplateh.sourcetype"/>', //
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.sourceType ? dataItem.sourceType : "";
                            $.each(HQM_SOURCE_TYPE_TEMP, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            return v;
                        },
                        editor: function(container, options) {
                            $('<input name="' + options.field + '"/>')
                                .appendTo(container)
                                .kendoDropDownList({
                                    dataTextField: "meaning",
                                    dataValueField: "value",
                                    valuePrimitive: true,
                                    dataSource: HQM_SOURCE_TYPE_TEMP
                                });
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }

                    }, {
                        field: "itemCategoryCode",
                        title: '<@spring.message "iqcinspectiontemplateh.itemcategory"/>', //IQC物料类别
                        width: 120,
                        hidden: true,
                        template: function(dataItem) {
                            var v = dataItem.itemCategoryCode ? dataItem.itemCategoryCode : "";
                            return v;
                        },
                        editor: function(container, options) {
                            if (options.model.itemId == '' || options.model.itemId == undefined || options.model.itemId == null) {
                                $('<span style="background-color:#C43C8D;color:white;">未选择物料</span>').appendTo(container);
                                return;
                            }
                            $('<input name="' + options.field + '"/>')
                                .appendTo(container)
                                .kendoLov($.extend( <@lov "LOV_ITEM_CATEGORY" /> , {
                                    //                     query: function (e) {
                                    //                     	e.param.itemId = options.model.itemId;
                                    //                     	e.param.plantId = options.model.plantId;
                                    //                     },
                                    textField: 'itemCategoryCode',
                                    model: options.model,
                                    change: function() {
                                        var v = this.value();
                                        if (v == undefined || v == "") {
                                            options.model.set("itemCategoryCode", '');
                                            options.model.set("itemCategory", '');
                                        } else {
                                            options.model.itemCategory = this._dataItem.categoryId;
                                        }
                                    }
                                }));
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }

                    }, {
                        field: "status",
                        title: '<@spring.message "iqcinspectiontemplateh.status"/>', //状态 FROM:hqmInspectionTemplateStatus
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.status ? dataItem.status : "";
                            $.each(hqmInspectionTemplateStatus, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            if (v == "未发布") {
                                return '<span style="color: #ffb01f">' + v + '</span>';
                            } else if (v == "已发布") {
                                return '<span style="color: green">' + v + '</span>';
                            } else {
                                return v;
                            }

                        },
                        editor: function(container, options) {
                            $('<input name="' + options.field + '"/>')
                                .appendTo(container)
                                .kendoDropDownList({
                                    dataTextField: "meaning",
                                    dataValueField: "value",
                                    valuePrimitive: true,
                                    dataSource: hqmInspectionTemplateStatus
                                });
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }

                    }, {
                        field: "columnCreationDate",
                        title: '<@spring.message "iqcinspectiontemplateh.creationdate"/>', //创建时间
                        width: 150,
                        hidden: true,
                        format: "{0:yyyy-MM-dd HH:mm:ss}",
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }

                    }, {
                        field: "versionNum",
                        title: '<@spring.message "iqcinspectiontemplateh.versionnum"/>', //版本号
                        width: 120,
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "timeLimit",
                        title: '<@spring.message "iqcinspectiontemplateh.timelimit"/>', //检验时效
                        width: 80,
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    },

                    {
                        field: "historyNum",
                        title: '<@spring.message "iqcinspectiontemplateh.historynum"/>', //历史版本
                        width: 120,
                        hidden: true,
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "drawingNumber",
                        title: '<@spring.message "iqcinspectiontemplateh.drawingnumber"/>', //图号
                        width: 120,
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        },
                        hidden: true,
                    }, {
                        field: "enableFlag",
                        title: '<@spring.message "iqcinspectiontemplateh.enableflag"/>', //有效性
                        width: 120,

                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        title: '<@spring.message "iqcinspectiontemplateh.operation"/>', //操作
                        width: 120,
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        },
                        template: function(item) {
                            return '<a href="javascript:void(0);" style="color:blue" onclick="openDetail(\'' + item.headerId + '\')">' + '<@spring.message "iqcinspectiontemplateh.detail"/>' + '</a>'
                        }
                    },{
                        title: '<@spring.message "hap.operate"/>',//操作
                        width: 80,
                        template: function(item){
                        	var str = '<a style="color: blue;" href="javascript:void(0);" onclick="viewHis('+ item.headerId +')"><@spring.message "hap.his"/></a>';
                        	return str;
                        }
                        
                    }
                ],
                editable: true
            }).data('kendoGrid');
        </script>
        <script>
        	$(function(){
        		if(mainType == "FQC" || mainType == "OQC")
        			grid.hideColumn("itemEdition")
        	})
        </script>
        <script type="text/javascript">
            dataSourceLine = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: BaseUrl + "/hqm/iqc/inspection/template/l/query",
                        type: "POST",
                        dataType: "json"
                    },
                    update: {
                        url: BaseUrl + "/hqm/iqc/inspection/template/l/submit",
                        type: "POST",
                        contentType: "application/json"
                    },
                    destroy: {
                        url: BaseUrl + "/hqm/iqc/inspection/template/l/remove",
                        type: "POST",
                        contentType: "application/json"
                    },
                    create: {
                        url: BaseUrl + "/hqm/iqc/inspection/template/l/submit",
                        type: "POST",
                        contentType: "application/json"
                    },
                    parameterMap: function(options, type) {
                        if (type !== "read" && options.models) {
                            var datas = Hap.prepareSubmitParameter(options, type)
                            for (var i = 0; i < datas.length; i++) {
                                datas[i].headerId = viewModelLine.model.headerId;
                            }
                            return kendo.stringify(datas);
                        } else if (type === "read") {
                            return Hap.prepareQueryParameter(viewModelLine.model.toJSON(), options)
                        }
                    }
                },
                batch: true,
                serverPaging: true,
                pageSize: 20,
                schema: {
                    data: 'rows',
                    total: 'total',
                    model: {
                        id: "lineId",
                        fields: {
                            orderCode: {
                                type: 'number',
                                format: "{0:0}",
                                validation: {
                                    min: 0,
                                    required: true,
                                    required: {
                                        message: "排序号为必输项"
                                    },
                                },
                            },
                            enableTime: {
                                type: 'date',
                                validation: {
                                    required: true,
                                },
                            }
                        },
                        editable: function(column) {
                            if (column == 'inspectionAttribute' || column == 'sampleProcedureType' || column == 'inspectionLevels' || column == 'qualityCharacterGrade' ||
                                column == 'acceptanceQualityLimit' || column == 'attributeType' || column == 'frequencyType' || column == 'inspectionTool' ||
                                column == 'frequency' || column == 'remark' || column == 'sourceType' || column == 'enableType' || column == 'standardType') {
                                //新增可编辑
                                if (this.isNew()) {
                                    return true;
                                }
                            }
                            if (column == 'textStandrad' || column == 'standradFrom' || column == 'orderCode' || column == 'standradTo' || column == 'standradUom' ||
                                column == 'enableTime' || column == 'disableTime' ||
                                column == 'isSync' || column == 'fillInType') {
                                //可修改列
                                return true;
                            }
                            return false;
                        }
                    }
                }
            });
        </script>
        <script type="text/javascript">
            var gridLine = $("#gridLine").kendoGrid({
                dataSource: dataSourceLine,
                resizable: true,
                scrollable: true,
                navigatable: false,
                selectable: 'multiple, rowbox',
                dataBound: function() {
                    if (parent.autoResizeIframe) {
                        parent.autoResizeIframe('${RequestParameters.functionCode!}')
                    }
                },
                pageable: {
                    pageSizes: [5, 10, 20, 50],
                    refresh: true,
                    buttonCount: 5
                },
                toolbar: [{
                        template: '<span data-bind="click:create" class="btn btn-primary  fa fa-plus-square">&nbsp;新建</span>'
                    }, {
                        template: '<span data-bind="click:save" class="btn btn-success fa fa-save">&nbsp;保存</span>'
                    }, {
                        template: '<span class="btn btn-danger"  data-bind="click:remove"><i class="fa fa-trash-o" style="margin-right:3px;"></i><@spring.message "hap.delete"/></span>'
                    },
                    /* {
            template: '<span data-bind="click:plusFunction" class="btn btn-success">另加检验项目</span>'
        }, */
                    //{
                    //    template: '<span data-bind="click:copyFunction" class="btn btn-success">复制</span>'
                    //}
                ],
                columns: [{
                        field: "orderCode",
                        title: '<@spring.message "iqcinspectiontemplatel.ordercode"/>', //排序码
                        width: 120,
                        locked: true,
                        template: function(item) {
                            return item['orderCode'] ? item['orderCode'] : '';
                        },
                        //             editor: function (container, options) {
                        //             	if(options.model.enableType=='M'){
                        //                 	$('<span>'+options.model.orderCode+'</span>').appendTo(container);
                        //             	}
                        //             	else{
                        //             		$('<input data-role="numerictextbox" class="k-input" name="'+options.field+'" required data-required-msg="无效数值">')
                        //                     .appendTo(container);
                        //             	}
                        //             },
                        attributes: {
                            style: "text-align:center;"
                        },
                        headerAttributes: {
                            style: "text-align:center;"
                        }
                    },

                    {
                        field: "inspectionAttribute",
                        title: '<@spring.message "iqcinspectiontemplatel.inspectionattribute"/>', //检验项名称LOV_HQM_INSPECTION_ATTRIBUTE
                        width: 120,
                        locked: true,
                        template: function(item) {
                            return item['inspectionAttribute'] || ''
                        },
                        editor: function(container, options) {
                            if (enableTypeFlag == 'D' || (enableTypeFlag == '' && options.model.enableType == 'D')) {
                                $('<input name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoLov($.extend( <@lov "LOV_HQM_INSPECTION_ATTRIBUTE" /> , {
                                        query: function(e) {
                                            var data = grid.selectedDataItems();
                                            var sourceType = data[data.length - 1].sourceType;
                                            e.param['sourceType'] = sourceType;
                                            //e.param['plantId']= options.model.plantId;
                                        },
                                        textField: 'inspectionAttribute',
                                        model: options.model,
                                        change: function() {
                                            var v = this.value();
                                            if (v == undefined || v == "") {

                                            } else {
                                                options.model.attributeId = this._dataItem.attributeId;
                                                options.model.set('inspectionAttribute', this._dataItem.inspectionAttribute);
                                                // 	                            options.model.set('orderCode',this._dataItem.orderCode);
                                                options.model.set('sampleProcedureType', this._dataItem.sampleProcedureType);
                                                options.model.set('standardType', this._dataItem.standardType);
                                                options.model.set('inspectionLevels', this._dataItem.inspectionLevels);
                                                options.model.set('qualityCharacterGrade', this._dataItem.qualityCharacterGrade);
                                                options.model.set('acceptanceQualityLimit', this._dataItem.acceptanceQualityLimit);
                                                options.model.set('attributeType', this._dataItem.attributeType);
                                                options.model.set('frequencyType', this._dataItem.frequencyType);
                                                options.model.set('frequency', this._dataItem.frequency);
                                                options.model.set('inspectionTool', this._dataItem.inspectionTool);
                                                options.model.set('remark', this._dataItem.remark);
                                                options.model.set('sourceType', this._dataItem.sourceType);
                                            }
                                        }
                                    }));
                            } else {
                                $('<input type="text" class="k-input k-textbox" name="' +
                                        options.field + '" required="required" data-required-msg="必输项" data-bind="value:' +
                                        options.field + '" >')
                                    .appendTo(container);
                            }

                        },
                        attributes: {
                            style: "text-align:center;white-space:nowrap;"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    },

                    {
                        field: "enableType",
                        title: '<@spring.message "iqcinspectiontemplatel.enabletype"/>', //生效类型     from look_up_code:HQM_IQC_ENABLE_TYPE
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.enableType ? dataItem.enableType : "";
                            $.each(hqmIqcEnableType, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            return v;
                        },
                        editor: function(container, options) {
                            $('<input name="' + options.field + '"/>')
                                .appendTo(container)
                                .kendoDropDownList({
                                    dataTextField: "meaning",
                                    dataValueField: "value",
                                    valuePrimitive: true,
                                    dataSource: hqmIqcEnableType
                                });
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }

                    }, {
                        field: "sampleProcedureType",
                        title: '<@spring.message "iqcinspectiontemplatel.sampleproceduretype"/>', //抽样标准类型    from look_up_code:HQM_IQC_SAMPLE_STANDARD_TYPE
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.sampleProcedureType ? dataItem.sampleProcedureType : "";
                            $.each(hqmIqcSampleStandardType, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            return v;
                        },
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                var v = options.model.sampleProcedureType ? options.model.sampleProcedureType : "";
                                $.each(hqmIqcSampleStandardType, function(i, n) {
                                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                        v = n.meaning;
                                    }
                                });
                                $('<span">' + v + '</span>').appendTo(container);
                            } else {
                                $('<input name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoDropDownList({
                                        dataTextField: "meaning",
                                        dataValueField: "value",
                                        valuePrimitive: true,
                                        dataSource: hqmIqcSampleStandardType
                                    });
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "inspectionLevels",
                        title: '<@spring.message "iqcinspectiontemplatel.inspectionlevels"/>', //检验水平     from look_up_code:HQM_IQC_INSPECTION_LEVELS
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.inspectionLevels ? dataItem.inspectionLevels : "";
                            $.each(hqmIqcIinspectionLevels, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            return v;
                        },
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                var v = options.model.inspectionLevels ? options.model.inspectionLevels : "";
                                $.each(hqmIqcIinspectionLevels, function(i, n) {
                                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                        v = n.meaning;
                                    }
                                });
                                $('<span">' + v + '</span>').appendTo(container);
                            } else {
                                $('<input name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoDropDownList({
                                        dataTextField: "meaning",
                                        dataValueField: "value",
                                        valuePrimitive: true,
                                        dataSource: hqmIqcIinspectionLevels
                                    });
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "qualityCharacterGrade",
                        title: '<@spring.message "iqcinspectiontemplatel.qualitycharactergrade"/>', //质量特性等级  from look_up_code: HQM_IQC_QUALITY_GRADE
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.qualityCharacterGrade ? dataItem.qualityCharacterGrade : "";
                            $.each(hqmIqcQualityGrade, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            return v;
                        },
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                var v = options.model.qualityCharacterGrade ? options.model.qualityCharacterGrade : "";
                                $.each(hqmIqcQualityGrade, function(i, n) {
                                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                        v = n.meaning;
                                    }
                                });
                                $('<span">' + v + '</span>').appendTo(container);
                            } else {
                                $('<input name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoDropDownList({
                                        dataTextField: "meaning",
                                        dataValueField: "value",
                                        valuePrimitive: true,
                                        dataSource: hqmIqcQualityGrade
                                    });
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "acceptanceQualityLimit",
                        title: '<@spring.message "iqcinspectiontemplatel.acceptancequalitylimit"/>', //aql值，质量接收限   from look_up_code:HQM_IQC_ACCEPTANCE_QUALITY_LIMIT
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.acceptanceQualityLimit ? dataItem.acceptanceQualityLimit : "";
                            $.each(hqmIqcAql, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            return v;
                        },
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                var v = options.model.acceptanceQualityLimit ? options.model.acceptanceQualityLimit : "";
                                $.each(hqmIqcAql, function(i, n) {
                                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                        v = n.meaning;
                                    }
                                });
                                $('<span">' + v + '</span>').appendTo(container);
                            } else {
                                $('<input name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoDropDownList({
                                        dataTextField: "meaning",
                                        dataValueField: "value",
                                        valuePrimitive: true,
                                        dataSource: hqmIqcAql
                                    });
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "standardType",
                        title: '<@spring.message "iqcinspectiontemplatel.standardtype"/>', //规格类型   from look_up_code:HQM_IQC_STANDARD_TYPE
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.standardType ? dataItem.standardType : "";
                            $.each(hqmIqcStandardType, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            return v;
                        },
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                var v = options.model.standardType ? options.model.standardType : "";
                                $.each(hqmIqcStandardType, function(i, n) {
                                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                        v = n.meaning;
                                    }
                                });
                                $('<span">' + v + '</span>').appendTo(container);
                            } else {
                                $('<input name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoDropDownList({
                                        dataTextField: "meaning",
                                        dataValueField: "value",
                                        valuePrimitive: true,
                                        dataSource: hqmIqcStandardType
                                    });
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "textStandrad",
                        title: '<@spring.message "iqcinspectiontemplatel.textstandrad"/>', //文本规格值
                        width: 120,
                        editor: function(container, options) {
                            if (options.model.standardType == 'D') {
                                $('<input data-role="maskedtextbox" class="k-input" name="' +
                                    options.field + '" required="required" data-required-msg="必输"  >').appendTo(container);

                            } else {
                                $('<span data-bind="text:textStandrad"></span>').appendTo(container);
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "standradFrom",
                        title: '<@spring.message "iqcinspectiontemplatel.standradfrom"/>', //规格值从
                        width: 120,
                        editor: function(container, options) {
                            if (options.model.standardType == 'D') {
                                $('<span data-bind="text:standradFrom"></span>').appendTo(container);
                            } else {
                                $('<input required name="' +
                                        options.field + '" data-required-msg="必输" >')
                                    .appendTo(container).kendoNumericTextBox({
                                        step: 1,
                                    });
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "standradTo",
                        title: '<@spring.message "iqcinspectiontemplatel.standradto"/>', //规格值至
                        width: 120,
                        editor: function(container, options) {
                            if (options.model.standardType == 'D') {
                                $('<span data-bind="text:standradTo"></span>').appendTo(container);
                            } else {
                                $('<input required name="' +
                                        options.field + '" data-required-msg="必输" >')
                                    .appendTo(container).kendoNumericTextBox({
                                        step: 1,
                                    });
                            }


                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "standradUom",
                        title: '<@spring.message "iqcinspectiontemplatel.standraduom"/>', //规格单位 from look_up_code:HQM_STANDRAD_UOM
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.standradUom ? dataItem.standradUom : "";
                            $.each(hqmStandradUom, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            })
                            return v;
                        },
                        editor: function(container, options) {
                            var v = options.model.standradUom ? options.model.standradUom : "";
                            $.each(hqmStandradUom, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            if (options.model.standardType == 'D') {
                                $('<span>' + v + '</span>').appendTo(container);
                            } else {
                                $('<input required name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoDropDownList({
                                        dataTextField: "meaning",
                                        dataValueField: "value",
                                        valuePrimitive: true,
                                        dataSource: hqmStandradUom
                                    });
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "attributeType",
                        title: '<@spring.message "iqcinspectiontemplatel.attributetype"/>', //检验项类型  from look_up_code:HQM_IQC_ATTRIBUTE_CATEGORY
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.attributeType ? dataItem.attributeType : "";
                            $.each(hqmIqcAttributeCategory, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            return v;
                        },
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                var v = options.model.attributeType ? options.model.attributeType : "";
                                $.each(hqmIqcAttributeCategory, function(i, n) {
                                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                        v = n.meaning;
                                    }
                                });
                                $('<span">' + v + '</span>').appendTo(container);
                            } else {
                                $('<input name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoDropDownList({
                                        dataTextField: "meaning",
                                        dataValueField: "value",
                                        valuePrimitive: true,
                                        dataSource: hqmIqcAttributeCategory
                                    });
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "frequencyType",
                        title: '<@spring.message "iqcinspectiontemplatel.frequencytype"/>', //频次类型   from look_up_code:HQM_IQC_FREQUENCY_TYPE
                        width: 120,
                        hidden: true,
                        template: function(dataItem) {
                            var v = dataItem.frequencyType ? dataItem.frequencyType : "";
                            $.each(hqmIqcFrequencyType, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            return v;
                        },
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                var v = options.model.frequencyType ? options.model.frequencyType : "";
                                $.each(hqmIqcFrequencyType, function(i, n) {
                                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                        v = n.meaning;
                                    }
                                });
                                $('<span">' + v + '</span>').appendTo(container);
                            } else {
                                $('<input name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoDropDownList({
                                        dataTextField: "meaning",
                                        dataValueField: "value",
                                        valuePrimitive: true,
                                        dataSource: hqmIqcFrequencyType
                                    });
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "frequency",
                        title: '<@spring.message "iqcinspectiontemplatel.frequency"/>', //频次
                        width: 120,
                        hidden: true,
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                $('<span data-bind="text:frequency"></span>').appendTo(container);
                            } else {
                                $('<input type="number" class="k-input k-textbox" name="' +
                                        options.field + '" required="required" data-required-msg="无效数值" data-bind="value:' +
                                        options.field + '" >')
                                    .appendTo(container);
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "inspectionTool",
                        title: '<@spring.message "iqcinspectiontemplatel.inspectiontool"/>', //检验工具

                        width: 120,
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                $('<span data-bind="text:inspectionTool"></span>').appendTo(container);
                            } else {
                                $('<input type="text" class="k-input k-textbox" name="' +
                                        options.field + '" required="required" data-required-msg="无效输入" data-bind="value:' +
                                        options.field + '" >')
                                    .appendTo(container);
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    },

                    {
                        field: "enableTime",
                        title: '<@spring.message "iqcinspectiontemplatel.enabletime"/>', //生效时间
                        width: 150,
                        format: "{0:yyyy-MM-dd HH:mm:ss}",
                        editor: function(container, options) {
                            $('<input required name="' + options.field + '"/>')
                                .appendTo(container)
                                .kendoDateTimePicker();
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "disableTime",
                        title: '<@spring.message "iqcinspectiontemplatel.disabletime"/>', //失效时间
                        width: 150,
                        format: "{0:yyyy-MM-dd HH:mm:ss}",
                        editor: function(container, options) {
                            $('<input name="' + options.field + '"/>')
                                .appendTo(container)
                                .kendoDateTimePicker();
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }

                    }, {
                        field: "sourceType",
                        title: '<@spring.message "iqcinspectiontemplatel.sourcetype"/>', //来源类型  from look_up_code:HQM_IQC_SOURCE_TYPE
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.sourceType ? dataItem.sourceType : "";
                            $.each(hqmIqcSourceType, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            });
                            return v;
                        },
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                var v = options.model.sourceType ? options.model.sourceType : "";
                                $.each(hqmIqcSourceType, function(i, n) {
                                    if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                        v = n.meaning;
                                    }
                                });
                                $('<span">' + v + '</span>').appendTo(container);
                            } else {
                                $('<input name="' + options.field + '"/>')
                                    .appendTo(container)
                                    .kendoDropDownList({
                                        dataTextField: "meaning",
                                        dataValueField: "value",
                                        valuePrimitive: true,
                                        dataSource: hqmIqcSourceType
                                    });
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "historyNum",
                        title: '<@spring.message "iqcinspectiontemplatel.historynum"/>', //历史版本号 from sequence:hqm_template_history_num_s
                        width: 120,
                        hidden: true,
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "isSync",
                        title: '<@spring.message "iqcinspectiontemplatel.issync"/>', //是否为同步检验项
                        width: 120,
                        hidden: true,
                        template: function(dataItem) {
                            var v = dataItem.isSync ? dataItem.isSync : "";
                            $.each(yesNo, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            })
                            return v;
                        },
                        editor: function(container, options) {
                            $('<input name="' + options.field + '"/>')
                                .appendTo(container)
                                .kendoDropDownList({
                                    dataTextField: "meaning",
                                    dataValueField: "value",
                                    valuePrimitive: true,
                                    dataSource: yesNo
                                });
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "fillInType",
                        title: '<@spring.message "iqcinspectiontemplatel.fillintype"/>', //填写类型 from look_up_code: HQM_IQC_FILL_IN_TYPE
                        width: 120,
                        template: function(dataItem) {
                            var v = dataItem.fillInType ? dataItem.fillInType : "";
                            $.each(hqmIqcFillInType, function(i, n) {
                                if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                                    v = n.meaning;
                                    return v;
                                }
                            })
                            return v;
                        },
                        editor: function(container, options) {
                            $('<input name="' + options.field + '"/>')
                                .appendTo(container)
                                .kendoDropDownList({
                                    dataTextField: "meaning",
                                    dataValueField: "value",
                                    valuePrimitive: true,
                                    dataSource: hqmIqcFillInType
                                });
                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    }, {
                        field: "remark",
                        title: '<@spring.message "iqcinspectiontemplatel.remark"/>', //备注

                        width: 120,
                        editor: function(container, options) {
                            if (options.model.enableType == 'D' && options.model.lineId != null && options.model.lineId != undefined) {
                                $('<span data-bind="text:remark"></span>').appendTo(container);
                            } else {
                                $('<input type="text" class="k-input k-textbox" name="' +
                                        options.field + '" required="required" data-required-msg="无效输入" data-bind="value:' +
                                        options.field + '" >')
                                    .appendTo(container);
                            }

                        },
                        attributes: {
                            style: "text-align:center"
                        },
                        headerAttributes: {
                            style: "text-align:center"
                        }
                    },

                ],
                editable: true
            }).data('kendoGrid');
            kendo.bind($('#gridLine'), viewModelLine);
        </script>
        <script>
            //var selection = $('#chooseGrid').data('kendoGrid').selectedDataItems();
            // $('#grid').on('click', '.k-checkbox', function () {
            //         //获得grid中选中的head_id
            //         //var row = grid.select();
            //         //var data = grid.dataItem(row);
            //         var data = grid.selectedDataItems();

            //         if (data == undefined||data == null || data.length==0) {
            //             gridLine.dataSource.data(new Array());
            //             viewModelLine.model.set('headerId', null);
            //             return;
            //         }
            //         var kid = data[data.length-1].headerId;

            //         //清空第二个grid
            //         gridLine.dataSource.data(new Array());

            //         //根据第一个grid选中的mo_id，查询显示第二个grid
            //         viewModelLine.model.headerId = kid;
            //         gridLine.dataSource.page(1);
            //     });
        </script>
    </body>

    </html>