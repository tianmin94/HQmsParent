<#include "../include/header.html">
<script src="${base.contextPath}/common/code?ANDON_ACTION_TYPE=ANDON_ACTION_TYPE" type="text/javascript"></script>
<script src="${base.contextPath}/common/code?SYS_YES_NO=SYS.YES_NO" type="text/javascript"></script>
<script src="${base.contextPath}/common/code?PO_STATUS=SRM_PO_STATUS"></script>
<script src="${base.contextPath}/common/code?PO_ORDER_TYPE=SRM_PO_TYPE"></script>
<script src="${base.contextPath}/common/code?URGENT_STATUS=SRM_URGENT_STATUS"></script>
<script src="${base.contextPath}/common/code?SRM_PURCHASE_GROUP=SRM_PURCHASE_GROUP"></script>
<script src="${base.contextPath}/lib/bootstrap-3.3.7/js/bootstrap.min.js"></script>
<script src="${base.contextPath}/lib/prints/doc_print.js" type="text/javascript" charset="UTF-8"></script>
 <script src="${base.contextPath}/common/code?HQM_8D_PROBLEM_SOURCE=HQM_8D_PROBLEM_SOURCE"></script>
 
 <script src="${base.contextPath}/common/code?HQM_8D_PROBLEM_LEVEL=HQM_8D_PROBLEM_LEVEL"></script>
 <script src="${base.contextPath}/common/code?HQM_8D_PROBLEM_TYPE=HQM_8D_PROBLEM_TYPE"></script>
 <script src="${base.contextPath}/common/code?HPM_ECR_RELEVANCE=HPM_ECR_RELEVANCE"></script>
 <script src="${base.contextPath}/common/code?HPM_ECR_IS=HPM_ECR_IS"></script>
<script type="text/javascript">
  ;
    
  
</script>
 <style type="text/css">
 .gridcell{
 	height:30px;
 }	
   .checking{     
		 display: inline-block;
            background: red;
            height: 12px;
            position: relative;
            width: 2px;
            transform: rotateZ(90deg);
            text-align: center;
            line-height: 20px; 
    }
    
      .plus-icon {
            display: inline-block;
            background: red;
            height: 12px;
            position: relative;
            width: 2px;
        }
        
        .plus-icon:after {
            background: red;
            content: "";
            height: 12px;
            left: 0;
            position: absolute;
            top: 0;
            width: 2px;
            transform: rotateZ(90deg)
        } 
    .panel-collapse .collapse:target  .checking{
		  border-left: 50px solid transparent;
    border-right: 50px solid transparent;
    border-top: 100px solid red;
	}
   .box {
            width: 20px;
            height: 20px;
            border: 1px solid #ddd;
            line-height: 20px;
            text-align: center;
        } 
 	.bor{
 		border:none;
 	} 
	div[role=tooltip].k-tooltip{
        padding: 2px;
        background: #5c9acf;
    }
    .k-tooltip-content{
        padding: 4px;
        text-align: left;
        background: #fff;
        color: #666;
    }
    .k-callout {
        border-bottom-color: #5c9acf;
    }
      #vertical {
                    height: 380px;
                    margin: 0 auto;
                }

                #middle-pane { color: #000; background-color: #ccc; }
                #bottom-pane { color: #000; background-color: #aaa; }
                #left-pane, #center-pane, #right-pane  { color: #000; background-color: #eee; }

                .pane-content {
                    padding: 0 10px;
    }
 .panel {
    /* border-radius: 0; */
   // border: none;
    border: 0.5px solid rgba(0, 0, 0, 0.17);
    margin-bottom: 0;
   a { 
    text-decoration: none;
    color: 	#000000;
    outline: 0 ;
    font-size:12px; 
    outline: 0;
}
.panel-title {
    padding: 0 20px 0 20px;
    font-size: 12px;
    line-height: 35px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis; 
}
.panel-heading {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
    height: 35px;
}
}
</style>
<body> 
<script type="text/javascript">
var viewModel = Hap.createGridViewModel("#grid");
var ecrno="1"
var individuationSql="";
var individuationValue="";
var functionCode="ECR_PLATFORM";
//function getHeader() {
    $.ajax({
        url: _basePath + '/sys/individuation/query/query/header',
        type: 'POST',
        jsonType: "json",
        async: false,
        success: function (data) {
           // functionCode = data;
        }
    });
//}
   //viewModel.model.set("ecrno","ECR20-00003");
// viewModel.model.set("individuationSql","and t.ecrno='ECR20-00003'");
function confirmWin() {
	 
	//getHeader();
	var dialog = $("#individuationWindow").kendoWindow(
			{ width: 1500,
				height: 300,
				title: '自定义查询',
				visible: false,
				iframe: true, 
				modal: true, 
	            content: '../sys_individuation_query/individuation_query.html?functionCode=' + functionCode + "&&individuationValue=" +individuationValue,
				close:function() {
					
					var a=individuationSql;
				// viewModel.model.set("ecrno","ECR20200323");
				viewModel.model.set("individuationSql",individuationSql);
				viewModel.query();
				}
			}).data("kendoWindow"); 
	dialog.center().open();
	
}


function getTemplate() { 
	dialog = $("#templateWindow").kendoWindow({ 
		width: 500,
		height: 300,
		title: '自定义',
		visible: false,
		iframe: true, 
		modal: true, 
		async:false,
		content: '../sys_individuation_template/individuation_template.html?functionCode=' + functionCode,
	close:function() {
		viewModel.model.individuationSql = individuationSql;
		viewModel.model.individuationValue = individuationValue;
		if(individuationSql==""){
			return;
		}
        confirmWin();
		//viewModel.query();
	}
	}).data("kendoWindow"); 
	dialog.center().open(); 

}

function ontest(id){
	$("#"+id).css("color","black");	
}


function process(){
	var row=$("#grid").data("kendoGrid").select();
	 var data =$("#grid").data("kendoGrid").dataItem(row);  
	 if(data==null){
		 kendo.ui.showInfoDialog({
             title: $l('hap.tip.info'),
             message: "请勾选左边一笔申请单再进行明细查看"
         });
		 return ;
	 }
	var dialog = $("#openWindow").kendoWindow({
	    actions: ["Close"],
	    width: "96%",
	    height: "70%",
	    title: 'ECR进度',
	    visible: false,
	    iframe: true,
	    modal: true,
	    content: 'ecr_project_tracking.html?ecrno=' + data.ecrno,
	    close: function () {
	    }
	}).data("kendoWindow");

	dialog.center().open();
}

</script> 
<div id="individuationWindow"></div>
<div id="templateWindow"></div>
<div id="openWindow"></div>
<div id="ecrDetail1"></div>
<div id="ecrDetail2"></div>
<div id="ecrDetail3"></div>
<div id="ecrDetail4"></div>
<div id="onhandWindow"></div>
<div id="page-content">
	<!-- 添加查询字段条件 -->
	<div class="form-horizontal" style="margin-top:10px">
		<div id="queryForm" class="row">
			<div class="col-sm-12">
				<div class="form-group">
					<!-- 创建时间 -->
					<label class="control-label" style="position:relative;min-height:1px;float:left"> <@spring.message "ecrplatform.createfrom"/> </label>
					<div class="col-sm-1">
						<input id="startDate" style="width:100%" data-bind="value:model.startDate"/>
					</div>
					<label class="control-label" style="position:relative;min-height:1px;float:left"> <@spring.message "ecrplatform.createto"/> </label>
					<div class="col-sm-1">
						<input id="endDate" style="width:100%"  data-bind="value:model.endDate"/>
						<script>
							
							$("#startDate").kendoDatePicker({
		                        change:function(){
									var value = this.value();
									var endDate = $("#endDate").data("kendoDatePicker");
									endDate.min(value);
								}
	                        }).data("kendoDatePicker");
							
							 $("#endDate").kendoDatePicker({
		                        change:function(){
									var value = this.value();
									var startDate = $("#startDate").data("kendoDatePicker");
									startDate.max(value);
								}
	                        }).data("kendoDatePicker");
						</script>
					</div>
					
					<!-- 关联词1 -->
					<!-- <div class="col-sm-1">
						<div class="col-sm-4"></div>
						<div class="col-sm-8">
							<input id="relevanceFirst" style="width:100%"  data-bind="value:model.relevanceFirst"/>
						</div>
						<script>
							$("#relevanceFirst").kendoDropDownList({
		                            dataTextField: "meaning",
		                            dataValueField: "value",
		                            valuePrimitive: true,
		                            dataSource: HPM_ECR_RELEVANCE
		                    });
						</script>
					</div> -->
					
					<!-- ECR负责人 -->
					<label class="control-label" style="position:relative;min-height:1px;float:left"> <@spring.message "ecrplatform.ecrdutyby"/> </label>
					<div class="col-sm-1">
						<input id="mainDuty" style="width:100%"  data-bind="value:model.mainDuty" class="k-textbox"/>
						<script>
							/* $("#mainDuty").kendoDropDownList({
		                            dataTextField: "meaning",
		                            dataValueField: "value",
		                            valuePrimitive: true,
		                            dataSource: HQM_8D_PROBLEM_LEVEL
	                        }); */
						</script>
					</div>
					
					<!-- 关联词2 -->
					<!-- <div class="col-sm-1">
						<div class="col-sm-4"></div>
						<div class="col-sm-8">
							<input id="relevanceSecond" style="width:100%"  data-bind="value:model.relevanceSecond"/>
						</div>
						<script>
							$("#relevanceSecond").kendoDropDownList({
		                            dataTextField: "meaning",
		                            dataValueField: "value",
		                            valuePrimitive: true,
		                            dataSource: HPM_ECR_RELEVANCE
	                        });
						</script>
					</div> -->
					
					<!-- 风险程度 -->
					<label class="control-label" style="position:relative;min-height:1px;float:left"> <@spring.message "ecrmain.riskdegree"/> </label>
					<div class="col-sm-1">
						<input id="riskdegree" style="width:100%;height:30px" data-bind="value:model.riskdegree" />
						<script>
							$("#riskdegree").kendoMultiSelect({
								optenLabel: ' ',
	                            dataTextField: "meaning",
	                            dataValueField: "value",
	                            valuePrimitive: true,
	                            dataSource: HQM_8D_PROBLEM_LEVEL
	                        });
						</script>
					</div>
					
					<span class="btn btn-primary k-grid-add" style="float:left;margin-right:5px;" onclick="queryData()"><@spring.message "hap.query"/></span>
					<span class="btn btn-primary k-grid-add" onclick="confirmWin()" style="float:left;margin-right:5px;"  ><@spring.message "ecrplatform.query"/></span>
        			<span class="btn btn-primary k-grid-add" onclick="getTemplate()" style="float:left;margin-right:5px;"><@spring.message "ecrplatform.personsettings	"/></span>
				 	<span class="btn btn-primary k-grid-add" style="float:left;margin-right:5px;" onclick="createNew()"><@spring.message "ecrplatform.new"/></span>
				 	<span class="btn btn-primary k-grid-add" style="float:left;margin-right:5px;" "><@spring.message "hap.edit"/></span>
				</div>
			</div>
			
		</div>
		<script>kendo.bind($('#queryForm'), viewModel);</script>
	</div>
    <div class="pull-left" id="toolbar-btn" style="padding-bottom:10px;">
       <!--  <span class="btn btn-primary k-grid-add" style="float:left;margin-right:5px;"  ><@spring.message "ecrplatform.personcheck"/></span>
        <span class="btn btn-success k-grid-save-changes"  style="float:left;margin-right:5px;"><@spring.message "ecrplatform.personin"/></span>
         <span class="btn btn-primary k-grid-add" style="float:left;margin-right:5px;"  ><@spring.message "ecrplatform.personapply"/></span>
        <span class="btn btn-success k-grid-save-changes"  style="float:left;margin-right:5px;"><@spring.message "ecrplatform.highrick"/></span> -->
         
        <!--  <span class="btn btn-primary k-grid-add" style="float:left;margin-right:5px;"  ><@spring.message "ecrplatform.update"/></span>
        <span class="btn btn-success k-grid-save-changes"   style="float:left;margin-right:5px;"><@spring.message "ecrplatform.cancel"/></span>
        
        <span class="btn btn-success k-grid-save-changes"  onclick="process()" style="float:left;margin-right:5px;"><@spring.message "ecrplatform.rate"/></span> -->
    </div>
    <script>
    function createNew(){
    	$('#collapse2').collapse('show');
    	$("#myFrameName").attr('src',"${base.contextPath}/pspc_ecr_platform/pspc_ecr_order_create.html") ;
    	$("#myFrameName" ).css("display",'table');
    	setSize("35%");
    }
    </script>
    <script>kendo.bind($('#toolbar-btn'), viewModel);</script>
     
    <script>kendo.bind($('#query-form'), viewModel);</script> 
   <div style="clear:both">
   <div id="horizontal" style="height: 100%; width: 100%;border:none">
    <div id ="tst" style="clear:both;width:20%;float:left;border:none">
        <div id="grid" ></div>
         </div>
        <div class="bor" id="boxs" style="width:80%" float:left">
        <div class="panel panel-default">
		<div class="panel-heading">
			<h1 class="panel-title" style="font-size:12px;background:white;border-bottom:1px solid rgba(0, 0, 0, 0.17)">
				<a data-toggle="collapse" data-parent="#accordion"
					href="" onclick="onMulLoad('myFrameName')"> 
					
					<div class="row" style="width:100%;">
					<div class="col-xs-10">
					<span><@spring.message "ecrplatform.message"/></span>
					 
					</div>
					<div class="col-xs-2" >
					<span id="tsts"  class="plus-icon "> </span>
					 
					</div>
					
				</a>
			</h1>
		</div>
		
		<div id="collapse2" class="panel-collapse collapse"> 
		<iframe  id="myFrameName" style="width:100%;frameborder=no;border:none" src="${base.contextPath}/pspc_ecr_platform/pspc_ecr_order_create.html?ecrno="+ ecrno></iframe> 
	</div>
	</div>
	
	<div class="panel panel-default">
		<div class="panel-heading">
			<h1 class="panel-title" style="font-size:12px;background:white;border-bottom:1px solid rgba(0, 0, 0, 0.17)">
			 	
				<a data-toggle="collapse" data-parent="#accordion"   style="font-size:1.05em;font-weight: 600"
					href="" onclick="onMulLoad('myFrameName1')" > 
					
					<div class="row" style="width:100%;">
					<div class="col-xs-10">
					<span><@spring.message "ecrplatform.allocation"/></span>
					 
					</div>
					<div class="col-xs-2" >
					<span id="tsts1"  class="plus-icon "> </span>
					 
					</div>
				</a>
			</h1>
		</div>
		
		<div id="collapse3" class="panel-collapse collapse"> 
		<iframe  id="myFrameName1" style="width:100%;frameborder=no;border:none"  ></iframe> 
	</div>
	</div>
	
	<div class="panel panel-default">
		<div class="panel-heading">
			<h1 class="panel-title" style="font-size:12px;background:white;border-bottom:1px solid rgba(0, 0, 0, 0.17)" >
				<a data-toggle="collapse" data-parent="#accordion" style="font-size:1.05em;font-weight: 600"
					href="" onclick="onMulLoad('myFrameName2')"> 
					
					<div class="row" style="width:100%;">
					<div class="col-xs-10">
					<span><@spring.message "ecrplatform.itemcontrol"/></span>
					 
					</div>
					<div class="col-xs-2" >
					<span id="tsts2"  class="plus-icon "> </span>
					 
					</div>
				</a>
			</h1>
		
		</div>
		<div id="collapse4" class="panel-collapse collapse"> 
		<iframe  id="myFrameName2" style="width:100%;frameborder=no;border:none" ></iframe> 
	</div>
	</div>
	
	<div class="panel panel-default">
		<div class="panel-heading">
			<h1 class="panel-title" style="font-size:12px;background:white;border-bottom:1px solid rgba(0, 0, 0, 0.17)">
				<a data-toggle="collapse" data-parent="#accordion" style="font-size:1.05em;font-weight: 600"
					href="" onclick="onMulLoad('myFrameName3')">  
					
					<div class="row" style="width:100%;">
					<div class="col-xs-10">
					<span><@spring.message "ecrplatform.solution"/></span>
					 
					</div>
					<div class="col-xs-2" >
					<span id="tsts3"  class="plus-icon "> </span>
					 
					</div>
				</a>
			</h1>
		
		</div>
		<div id="collapse5" class="panel-collapse collapse"> 
		<iframe  id="myFrameName3" style="width:100%;frameborder=no;border:none" ></iframe> 
	</div>
	</div>
	   
	   <div class="panel panel-default">
		<div class="panel-heading">
			<h1 class="panel-title" style="font-size:12px;background:white;border-bottom:1px solid rgba(0, 0, 0, 0.17)">
				<a data-toggle="collapse" data-parent="#accordion" style="font-size:1.05em;font-weight: 600"
					href="" onclick="onMulLoad('myFrameName4')"> 
					
					<div class="row" style="width:100%;">
					<div class="col-xs-10">
					<span><@spring.message "ecrplatform.tech"/></span>
					 
					</div>
					<div class="col-xs-2" >
					<span id="tsts4"  class="plus-icon "> </span>
					 
					</div>
				</a>
			</h1>
		
		</div>
		<div id="collapse6" class="panel-collapse collapse"> 
		<iframe  id="myFrameName4" style="width:100%;frameborder=no;border:none"  ></iframe> 
	</div>
	</div>
	   
	   
	   <div class="panel panel-default">
		<div class="panel-heading">
			<h1 class="panel-title" style="font-size:12px;background:white;border-bottom:1px solid rgba(0, 0, 0, 0.17)">
				<a data-toggle="collapse" data-parent="#accordion" style="font-size:1.05em;font-weight: 600"
					href="" onclick="onMulLoad('myFrameName5')"> 
					
					<div class="row" style="width:100%;">
					<div class="col-xs-10">
					<span><@spring.message "ecrplatform.qtp"/></span>
					 
					</div>
					<div class="col-xs-2" >
					<span id="tsts5"  class="plus-icon "> </span>
					 
					</div>
				</a>
			</h1>
		
		</div>
		<div id="collapse7" class="panel-collapse collapse"> 
		<iframe  id="myFrameName5" style="width:100%;frameborder=no;border:none" ></iframe> 
	</div>
	</div>
	
	<div class="panel panel-default">
		<div class="panel-heading">
			<h1 class="panel-title" style="font-size:12px;background:white">
				<a data-toggle="collapse" data-parent="#accordion" style="font-size:1.05em;font-weight: 600"
					href="" onclick="onMulLoad('myFrameName6')"> 
					
					<div class="row" style="width:100%;">
					<div class="col-xs-10">
					<span><@spring.message "ecrplatform.vtp"/></span>
					 
					</div>
					<div class="col-xs-2" >
					<span id="tsts6"  class="plus-icon "> </span>
					 
					</div>
				</a>
			</h1>
		
		</div>
		<div id="collapse8" class="panel-collapse collapse"> 
		<iframe  id="myFrameName6" style="width:100%;frameborder=no;border:none" ></iframe>
	</div>
	</div>
	
	<div class="panel panel-default">
		<div class="panel-heading">
			<h1 class="panel-title" style="font-size:12px;background:white;border-bottom:1px solid rgba(0, 0, 0, 0.17)">
				<a data-toggle="collapse" data-parent="#accordion" style="font-size:1.05em;font-weight: 600"
					href="" onclick="onMulLoad('myFrameName7')"> 
					
					<div class="row" style="width:100%;">
					<div class="col-xs-10">
					<span><@spring.message "ecrplatform.pci"/></span>
					 
					</div>
					<div class="col-xs-2" >
					<span id="tsts7"  class="plus-icon "> </span>
					 
					</div>
				</a>
			</h1>
		
		</div>
		<div id="collapse9" class="panel-collapse collapse"> 
		<iframe  id="myFrameName7" style="width:100%;frameborder=no;border:none"   ></iframe> 
	</div>
	</div>
	
	<div class="panel panel-default">
		<div class="panel-heading">
			<h1 class="panel-title" style="font-size:12px;background:white;border-bottom:1px solid rgba(0, 0, 0, 0.17)">
				<a data-toggle="collapse" data-parent="#accordion" style="font-size:1.05em;font-weight: 600"
					href="" onclick="onMulLoad('myFrameName8')"> 
					
					<div class="row" style="width:100%;">
					<div class="col-xs-10"   >
					<span><@spring.message "ecrplatform.checkin"/></span>
					 
					</div>
					<div class="col-xs-2" >
					<span id="tsts8"  class="plus-icon "> </span>
					 
					</div>
				</a>
			</h1>
		
		</div>
		<div id="collapse10"  class="panel-collapse collapse"> 
		 <iframe  id="myFrameName8" style="width:100%;frameborder=no;border:none"   ></iframe> 
	</div>
	</div>
	
	 
	</div>
        </div> 
	
 </div>
</div>

<script type="text/javascript">
viewModel.model.set("myFrameName","${base.contextPath}/pspc_ecr_platform/pspc_ecr_order_create.html?ecrno=");
viewModel.model.set("myFrameName1","${base.contextPath}/pspc_ecr_platform/ecr_person.html?ecrno=") ;
viewModel.model.set("myFrameName2","${base.contextPath}/pspc_ecr_platform/item_control.html?ecrno=") ;
viewModel.model.set("myFrameName3","${base.contextPath}/pspc_ecr_platform/solution.html?ecrno=") ;
viewModel.model.set("myFrameName4","${base.contextPath}/pspc_ecr_platform/pspc_ecr_technical_file.html?ecrno=") ;
viewModel.model.set("myFrameName5","${base.contextPath}/pspc_ecr_platform/pspc_ecr_qtp.html?ecrno=") ;
viewModel.model.set("myFrameName6","${base.contextPath}/pspc_ecr_platform/pspc_ecr_vtp.html?ecrno=") ;
viewModel.model.set("myFrameName7","${base.contextPath}/pspc_ecr_platform/pspc_ecr_pci.html?ecrno=") ;
viewModel.model.set("myFrameName8","${base.contextPath}/pspc_ecr_platform/pspc_ecr_approve.html?ecrno=") ;
viewModel.model.set("myFrameName"+"ct","collapse2");
viewModel.model.set("myFrameName1"+"ct","collapse3") ;
viewModel.model.set("myFrameName2"+"ct","collapse4") ;
viewModel.model.set("myFrameName3"+"ct","collapse5") ;
viewModel.model.set("myFrameName4"+"ct","collapse6") ;
viewModel.model.set("myFrameName5"+"ct","collapse7") ;
viewModel.model.set("myFrameName6"+"ct","collapse8") ;
viewModel.model.set("myFrameName7"+"ct","collapse9") ;
viewModel.model.set("myFrameName8"+"ct","collapse10") ;

viewModel.model.set("myFrameName"+"s","tsts");
viewModel.model.set("myFrameName1"+"s","tsts1") ;
viewModel.model.set("myFrameName2"+"s","tsts2") ;
viewModel.model.set("myFrameName3"+"s","tsts3") ;
viewModel.model.set("myFrameName4"+"s","tsts4") ;
viewModel.model.set("myFrameName5"+"s","tsts5") ;
viewModel.model.set("myFrameName6"+"s","tsts6") ;
viewModel.model.set("myFrameName7"+"s","tsts7") ;
viewModel.model.set("myFrameName8"+"s","tsts8") ;
function onMulLoad(name){
	 var row=$("#grid").data("kendoGrid").select();
	 var data =$("#grid").data("kendoGrid").dataItem(row);  
	 if(data!=null){
		 if($("#"+name).css("display")=="none"){
			$("#"+name).attr('src',viewModel.model.get(name)+data.ecrno) ;
			$("#"+name).css("display",'table');	
			$('#'+viewModel.model.get(name+"ct")).collapse('show'); 
			$("#"+viewModel.model.get(name+"s")).addClass('checking');
			 $("#"+viewModel.model.get(name+"s")).removeClass('plus-icon');
		 
		 }
		 else{
			  // $("#"+name).attr('src',viewModel.model.get(name)+data.ecrno) ;
				$("#"+name).css("display",'none');	
				$('#'+viewModel.model.get(name+"ct")).collapse('hide');
				$("#"+viewModel.model.get(name+"s")).removeClass('checking');
				$("#"+viewModel.model.get(name+"s")).addClass('plus-icon');			 
		 }
	 }
	 else{
		 kendo.ui.showInfoDialog({
             title: $l('hap.tip.info'),
             message: "请勾选左边一笔申请单再进行明细查看"
         });
		 $("#"+name).css("display",'none');	
		$('#'+viewModel.model.get(name+"ct")).collapse('hide');
		$("#"+viewModel.model.get(name+"s")).removeClass('checking');
		$("#"+viewModel.model.get(name+"s")).addClass('plus-icon');		
		 //hide
		// $("#collapse3").css("display",'none')
	 }
}
function onChanging(ecrno){
	  var row=$("#grid").data("kendoGrid").select();
	$('#collapse2').collapse('show');
	$("#myFrameName").attr('src',"${base.contextPath}/pspc_ecr_platform/pspc_ecr_order_create.html?ecrno="+ecrno);
	$("#myFrameName").css("display",'table');
	
}
	
var horizontal =  $("#horizontal").kendoSplitter({
    orientation: "horizontal",
    panes: [
        { collapsible: false, size: "35%" },
        { collapsible: false, size:"65%" }
    ]
}).data("kendoSplitter");

function isString(str){
	return (typeof str == 'string') && str.constructor == String;
}

//文本超出提示
var toolTipOpt = {
	    show: function(e){
	        if($.trim(this.content.text()) !=""){
	            $('[role="tooltip"]').css("visibility", "visible");
	        }
	    },
	    hide: function(){
	        $('[role="tooltip"]').css("visibility", "hidden");
	    },
	    filter: "td:nth-child(n+3)",
	    content: function(e){
	        var element = e.target[0];
	        if(element.offsetWidth < element.scrollWidth){
	            var text = $(e.target).text();
	            return '<div style="min-width:100px;max-width: 1000px;">' + text + '</div>';
	        }else{
	            //解决鼠标一开始放在上面出现空模块
	            $('[role="tooltip"]').css("visibility", "hidden");
	            return "";
	        }
	    }
	};
//屏幕可用高度，折算一个可用比例作为部分区域的高度
	var webWidth=window.screen.availHeight*0.8; 
	$('#boxs').css("height",webWidth*0.88);
	$('#boxTotal').css("height",webWidth*0.88);
	
	$('#tst').css("height",webWidth*0.88);
	
	$('#horizontal').css("height",webWidth*0.88);
	$('#grid').css("height",webWidth*0.86);
	var webWidth1=window.screen.availHeight*0.7	; 
	$('#myFrameName8').css("height",webWidth1*0.8);
	$('#myFrameName7').css("height",webWidth1*0.8);
	$('#myFrameName6').css("height",webWidth1*0.8);
	$('#myFrameName5').css("height",webWidth1*0.8);
	$('#myFrameName4').css("height",webWidth1*0.8);
	$('#myFrameName3').css("height",webWidth1*0.7);
	$('#myFrameName2').css("height",webWidth1*0.7);
	$('#myFrameName1').css("height",webWidth1*0.15);
	$('#myFrameName').css("height",webWidth1*0.8); 
	$('#myFrameName1').css("display",'none');
	$('#myFrameName2').css("display",'none');
	$('#myFrameName3').css("display",'none');
	$('#myFrameName4').css("display",'none');
	$('#myFrameName5').css("display",'none');
	$('#myFrameName6').css("display",'none');
	$('#myFrameName7').css("display",'none');
	$('#myFrameName8').css("display",'none');
    Hap.initEnterQuery('#query-form', viewModel.query);
    var BaseUrl = _basePath;
    
    dataSource = new kendo.data.DataSource({
        transport: {
        	   read: {
                   url: BaseUrl + "/hpm/ecr/main/query",
                   type: "POST",
                   dataType: "json"
               },
               update: {
                   url: BaseUrl + "/hpm/ecr/main/submit",
                   type: "POST",
                   contentType: "application/json"
               },
               destroy: {
                   url: BaseUrl + "/hpm/ecr/main/remove",
                   type: "POST",
                   contentType: "application/json"
               },
               create: {
                   url: BaseUrl + "/hpm/ecr/main/submit",
                   type: "POST",
                   contentType: "application/json"
               },
            parameterMap: function (options, type) {
                if (type !== "read" && options.models) {
                    var datas = Hap.prepareSubmitParameter(options, type)
                    return kendo.stringify(datas);
                } else if (type === "read") {
                	var qy = Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                	if(qy.riskdegree != null && !isString(qy.riskdegree) && qy.riskdegree.length!=0){
    						var riskdegree = qy.riskdegree.join(";");
        					qy.riskdegree = riskdegree;
   					}
                    return qy;
                }
            }
        },
        batch: true,
        serverPaging: true,
        pageSize: 17,
        schema: {
        	data: 'rows',
            total: 'total',
            model: {
                id: "ecrno",
                fields: {}
            },
            editable: function (col) {
           	               
                return false;
            }
        }
    });

    var grid = $("#grid").kendoGrid({
    	 dataSource: dataSource,
         resizable: true,
         scrollable: true,
         navigatable: false,
         sortable:true,
         selectable: 'single, rowbox',
        columnMenu:true,
     //   filterable:true,
        dataBound: function () {
            if (parent.autoResizeIframe) {
                parent.autoResizeIframe('${RequestParameters.functionCode!}')
            }
        },
        pageable: {
            pageSizes: [17, 34, 51, 69],
            refresh: true,
            buttonCount: 5
        },
        columns: [
            {
                field: "ecrno",
                title: '<@spring.message "ecrmain.ecrno"/>', 
                attributes: {style: "text-align:center;white-space:nowrap ;text-overflow:ellipsis"},
                headerAttributes: {style: "text-align:center"},
                width: 120,
                height:20,
                locked: true,//固定列
            	lockable: false,            	
                template : function (rowdata) {
                	
                    if (!!rowdata.ecrno) {
                        return '<a href="javascript:void(0)" style="color:blue" onclick="onChanging(\''+rowdata.ecrno+ '\')">'+rowdata.ecrno+ '</a>'
                     //   return '<a href="javascript:void(0)" style="color:blue" onclick="detail(\''+rowdata.useOrderNumber+'\')">'+rowdata.useOrderNumber+'</a>'
                    }
                    return '';
                },
 
            },
            {
                field: "issue",
                title: '<@spring.message "ecrmain.issue"/>',
                attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                locked: true,//固定列
            	lockable: false,
            	height:20,
                width: 120
            },
                    {
                field: "mainDuty",
                title: '<@spring.message "ecrplatform.allocation"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120
            },
                    {
                field: "createdBy",
                title: '<@spring.message "ecrplatform.createdBy"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120
            },
                    {
                field: "status",
                title: '<@spring.message "ecrplatform.status"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 80
            },
                    {
                field: "planChangeDate",
                title: '<@spring.message "ecrplatform.planChangeDate"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120,
                template: function(e){
                	var dateTime = e['planChangeDate'];
                	if(dateTime){
                		return new Date(dateTime).Format("yyyy-MM-dd")
                	} else {
                		return "";
                	}
                }
            },
                    {
                field: "actChangeDate",
                title: '<@spring.message "ecrplatform.actChangeDate"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120,
                template: function(e){
                	var dateTime = e['actChangeDate'];
                	if(dateTime){
                		return new Date(dateTime).Format("yyyy-MM-dd")
                	} else {
                		return "";
                	}
                }
            },
                    {
                field: "planFinishedDate",
                title: '<@spring.message "ecrmain.finishdateplan"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120
            },
                    {
                field: "issueMsg",
                title: '<@spring.message "ecrmain.solution"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120
            },
                    {
                field: "creationDate",
                title: '<@spring.message "ecrmain.happenddatetime"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120,
                template: function(e){
                	var dateTime = e['creationDate'];
                	if(dateTime){
                		return new Date(dateTime).Format("yyyy-MM-dd")
                	} else {
                		return "";
                	}
                }
            },
                    {
                field: "sampleFlag",
                title: '<@spring.message "ecrmain.hassample"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120,
                template: function (dataItem) {
                    var v = dataItem.sampleFlag ? dataItem.sampleFlag : "";
                    $.each(SYS_YES_NO, function (i, n) {
                        if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                            v = n.meaning;
                            return v;
                        }
                    })
                    return v;
                },
                editor: function (container, options) {
                    $('<input name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            dataTextField: "meaning",
                            dataValueField: "value",
                            valuePrimitive: true,
                            dataSource: SYS_YES_NO
                        });
                }
            },
                    {
                field: "issuesourceno",
                title: '<@spring.message "ecrmain.issuesourceno"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                width: 120,
                height:20,
                template: function (dataItem) {
                    var v = dataItem.issuesourceno ? dataItem.issuesourceno : "";
                    $.each(HQM_8D_PROBLEM_SOURCE, function (i, n) {
                        if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                            v = n.meaning;
                            return v;
                        }
                    })
                    return v;
                },
                editor: function (container, options) {
                    $('<input name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            dataTextField: "meaning",
                            dataValueField: "value",
                            valuePrimitive: true,
                            dataSource: HQM_8D_PROBLEM_SOURCE
                        });
                }
                
                
            },
                    {
                field: "matneedcontrol",
                title: '<@spring.message "ecrmain.matneedcontrol"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                width: 120,
                height:20,
                template: function (dataItem) {
                	var yn = false;
                    var v = dataItem.matneedcontrol ? dataItem.matneedcontrol : "";
                    $.each(SYS_YES_NO, function (i, n) {
                        if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                        	if("Y" == n.value){
                        		yn = true;
                        	}
                            v = n.meaning;
                            return v;
                        }
                    })
                    if(yn){
                    	return Hap.createAnchor(v, openEcrDetail, dataItem.ecrno,'matneedcontrol');
                    }
                    return v;
                },
                editor: function (container, options) {
                    $('<input name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            dataTextField: "meaning",
                            dataValueField: "value",
                            valuePrimitive: true,
                            dataSource: SYS_YES_NO
                        });
                }
            },
                    {
                field: "issueType",
                title: '<@spring.message "ecrmain.issueType"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                width: 120,
                height:20,
                template: function (dataItem) {
                    var v = dataItem.issueType ? dataItem.issueType : "";
                    $.each(HQM_8D_PROBLEM_TYPE, function (i, n) {
                        if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                            v = n.meaning;
                            return v;
                        }
                    })
                    return v;
                },
                editor: function (container, options) {
                    $('<input name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            dataTextField: "meaning",
                            dataValueField: "value",
                            valuePrimitive: true,
                            dataSource: HQM_8D_PROBLEM_TYPE
                        });
                }
            },
                    {
                field: "riskdegree",
                title: '<@spring.message "ecrmain.riskdegree"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                width: 120,
                height:20,
                template: function (dataItem) {
                    var v = dataItem.riskdegree ? dataItem.riskdegree : "";
                    $.each(HQM_8D_PROBLEM_LEVEL, function (i, n) {
                        if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                            v = n.meaning;
                            return v;
                        }
                    })
                    return v;
                },
                editor: function (container, options) {
                    $('<input name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            dataTextField: "meaning",
                            dataValueField: "value",
                            valuePrimitive: true,
                            dataSource: HQM_8D_PROBLEM_LEVEL
                        });
                }
            },
                    {
                field: "ufr",
                title: '<@spring.message "ecrmain.ufr"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120
            },
                    {
                field: "ecrTraking",
                title: '<@spring.message "ecrmain.ecrTraking"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120,
                template: function (dataItem) {
                  	if (!!dataItem.ecrno) {
                       return Hap.createAnchor("ECR进度", openEcrDetail, dataItem.ecrno, 'ecrTraking');
                    } else{
                        return "ECR进度";	
                    }
                },
            },
                    {
                field: "qtpFlag",
                title: '<@spring.message "ecrmain.qtpFlag"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120,
                template: function (dataItem) {
                    var v = dataItem.qtpFlag ? dataItem.qtpFlag : "";
                    var isNeed = false;
                    $.each(HPM_ECR_IS, function (i, n) {
                    	if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                            v = n.meaning;
                            if (n.value == 'Y' && !!dataItem.ecrno) {
                            	isNeed = true;
                            }
                            return v;
                        }
                    })
                    if(isNeed){
                    	return Hap.createAnchor(v, openEcrDetail, dataItem.ecrno,'qtpFlag');
                    }
                    return v;
                },
                editor: function (container, options) {
                    $('<input name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            dataTextField: "meaning",
                            dataValueField: "value",
                            valuePrimitive: true,
                            dataSource: HPM_ECR_IS
                        });
                }
            },
                    {
                field: "vtpFlag",
                title: '<@spring.message "ecrmain.vtpFlag"/>', attributes: {style: "text-align:center;white-space:nowrap "},
                headerAttributes: {style: "text-align:center"},
                height:20,
                width: 120,
                template: function (dataItem) {
                    var v = dataItem.vtpFlag ? dataItem.vtpFlag : "";
                    var isNeed = false;
                    $.each(HPM_ECR_IS, function (i, n) {
                        if ((n.value || '').toLowerCase() == (v || '').toLowerCase()) {
                            v = n.meaning;
                            if (n.value == 'Y' && !!dataItem.ecrno) {
                            	isNeed = true;
                            }
                            return v;
                        }
                    })
                    if(isNeed){
                    	return Hap.createAnchor(v, openEcrDetail, dataItem.ecrno,'vtpFlag');
                    }
                    return v;
                },
                editor: function (container, options) {
                    $('<input name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            dataTextField: "meaning",
                            dataValueField: "value",
                            valuePrimitive: true,
                            dataSource: HPM_ECR_IS
                        });
                }
            },
                
        ],
        editable: false,
        change:onChange
    }).data("kendoGrid");
    $("#grid").kendoTooltip(toolTipOpt).data("kendoTooltip");
  //获取左边grid选中事件
  function onChange(){
	  var row=$("#grid").data("kendoGrid").select();
	  setSize('35%');
  	//$('#collapse2').collapse('show');
  //	$("#myFrameName").attr('src',"${base.contextPath}/pspc_ecr_platform/pspc_ecr_order_create.html?ecrno="+ecrno);
	//$("#myFrameName1").attr('src',"${base.contextPath}/pspc_ecr_platform/ecr_person.html?ecrno="+$("#grid").data("kendoGrid").dataItem(row).ecrno) ;
	//$("#myFrameName2").attr('src',"${base.contextPath}/pspc_ecr_platform/item_control.html?ecrno="+$("#grid").data("kendoGrid").dataItem(row).ecrno) ;
	//$("#myFrameName6").attr('src',"${base.contextPath}/pspc_ecr_platform/pspc_ecr_vtp.html?ecrno="+$("#grid").data("kendoGrid").dataItem(row).ecrno) ;
//	$("#myFrameName3").attr('src',"${base.contextPath}/pspc_ecr_platform/solution.html?ecrno="+$("#grid").data("kendoGrid").dataItem(row).ecrno) ;
	//$("#myFrameName4").attr('src',"${base.contextPath}/pspc_ecr_platform/pspc_ecr_technical_file.html?ecrno="+$("#grid").data("kendoGrid").dataItem(row).ecrno) ;
	//$("#myFrameName5").attr('src',"${base.contextPath}/pspc_ecr_platform/pspc_ecr_qtp.html?ecrno="+$("#grid").data("kendoGrid").dataItem(row).ecrno) ;
	//$("#myFrameName7").attr('src',"${base.contextPath}/pspc_ecr_platform/pspc_ecr_pci.html?ecrno="+$("#grid").data("kendoGrid").dataItem(row).ecrno) ;
//	$("#myFrameName8").attr('src',"${base.contextPath}/pspc_ecr_platform/pspc_ecr_approve.html?ecrno="+$("#grid").data("kendoGrid").dataItem(row).ecrno) ;
	//$('#myFrameName1').css("display",'table');
	//$('#myFrameName2').css("display",'table');
	//$('#myFrameName3').css("display",'table');
	//$('#myFrameName4').css("display",'table');
	//$('#myFrameName5').css("display",'table');
	//$('#myFrameName6').css("display",'table');
	//$('#myFrameName7').css("display",'table');
	
  }
 
   /* $("#grid").on('click','.k-grid-content .k-rowbox',function(){
    	var row=$("#grid").data("kendoGrid").select();
    	$('#collapse2').collapse('show');
    })
     
    	
    	 $("#grid").on('click','.k-grid-content tr',function(){
    	var row=$("#grid").data("kendoGrid").select();
    	$('#collapse2').collapse('show');
    })*/
    

  //鼠标悬停时修改grid行背景色
     $("#grid").bind("mouseover","div.k-grid-content tr", function (e) { 
    	 if(!e || !e.toElement){return;}
    	 if(e.toElement.localName!="td")
    		 return;
        var uid = e.toElement.parentElement.dataset.uid;
        if(uid==undefined){
        	return;
        }
        //得到所选行数据
        var row1 = $("#grid").data("kendoGrid").dataSource.getByUid(uid);
        $("#grid tbody").find("tr[data-uid=" + uid + "]").css("background-color","#53f047");
        //整行加颜色
      //  $(this).css("background-color", "#53f047");
 
    });

    //鼠标离开时取消grid行背景色
     $("#grid").bind("mouseout", "div.k-grid-content tr",  function (e) {
    	 if(!e || !e.fromElement){return;}
    	 if(e.fromElement.localName!="td")
    		 return;
    	 var uid = e.fromElement.parentElement.dataset.uid;
         if(uid==undefined){
         	return;
         }
         //得到所选行数据
         var row1 = $("#grid").data("kendoGrid").dataSource.getByUid(uid);
        $("#grid tbody").find("tr[data-uid=" + uid + "]").css("background-color","#fFFFFF");
    });    
     
    
    
    // 打开窗口
    function openEcrDetail(ecrno, type){
    	if(!type){
    		return;
    	}
    	var url = '';
    	var title = '详情'
    	var height = '80%';
    	var width = '80%';
    	switch(type){
    	case 'ecrTraking':
    		url = '/pspc_ecr_platform/ecr_project_tracking.html?ecrno=' + ecrno;
    		title = 'ECR 进度'
    		height = '900px';
        	width = '1500px';
        	openNormalWindow(ecrno, url, title, height, width,1);
    		break;
    	case 'qtpFlag':
    		url = '/pspc_ecr_platform/pspc_ecr_qtp.html?ecrno=' + ecrno;
    		title = 'QTP';
    		height = '600px';
        	width = '1200px';
        	openNormalWindow(ecrno, url, title, height, width,2);
    		break;
    	case 'vtpFlag':
    		url = '/pspc_ecr_platform/pspc_ecr_vtp.html?ecrno=' + ecrno;
    		title = 'VTP';
    		height = '600px';
        	width = '1200px';
        	openNormalWindow(ecrno, url, title, height, width,3);
    		break;
    	case 'matneedcontrol':
    		url = '/pspc_ecr_platform/item_control.html?ecrno=' + ecrno;
    		title = '物料管控'
    		height = '700px';
        	width = '1200px';
        	openNormalWindow(ecrno, url, title, height, width,4);
    		break;
    	default:
    		return;
    		break;
    	}
    }
    

    function openNormalWindow(ecrno, url, title, height, width,i){ 
		$("#ecrDetail"+i).kendoWindow({
			title: title,
			content:'${base.contextPath}' + url,
			height: height,
			width: width,
			model:true,
			visiable:false,
			iframe:true
		}).data("kendoWindow").center().open();		 
    }
  
    
    // 获取 pane
    getPane = function (index) {
    	var horizontalElement = $("#horizontal"),
        index = Number(index);
        var panes = horizontalElement.children(".k-pane");
        if(!isNaN(index) && index < panes.length) {
            return panes[index];
        }
    }
    
    // 设置 size
    var setSize = function (e) {
       	var pane = getPane(0);
        if (!pane) return;
        horizontal.size(pane, e);
    }
    
    // 查询
    function queryData(){
    	setSize('100%');
    	viewModel.query();
    }

    setSize('100%');
</script>
</body>
</html>